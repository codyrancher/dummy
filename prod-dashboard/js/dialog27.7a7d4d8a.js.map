{"version":3,"sources":["webpack:///./shell/dialog/RotateCertificatesDialog.vue?de63","webpack:///shell/dialog/RotateCertificatesDialog.vue","webpack:///./shell/dialog/RotateCertificatesDialog.vue?3061","webpack:///./shell/dialog/RotateCertificatesDialog.vue","webpack:///./shell/dialog/RotateCertificatesDialog.vue?7d6a"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","style","attrs","scopedSlots","_u","key","fn","_v","_s","t","proxy","_l","error","i","value","label","model","callback","$$v","rotateAllServices","expression","class","serviceOptions","selectedService","slot","on","close","rotate","staticRenderFns","components","Select","RadioGroup","Card","AsyncButton","Banner","props","cluster","type","default","data","errors","computed","options","actionParams","services","caCertificates","mounted","methods","buttonDone","params","currentGeneration","set","generation","component"],"mappings":"mHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,OAAO,CAACE,YAAY,gBAAgBC,MAAM,CAAE,OAAS,QAASC,MAAM,CAAC,yBAAwB,GAAOC,YAAYT,EAAIU,GAAG,CAAC,CAACC,IAAI,QAAQC,GAAG,WAAW,MAAO,CAACR,EAAG,KAAK,CAACJ,EAAIa,GAAGb,EAAIc,GAAGd,EAAIe,EAAE,+CAA+CC,OAAM,GAAM,CAACL,IAAI,OAAOC,GAAG,WAAW,MAAO,CAACZ,EAAIiB,GAAIjB,EAAU,QAAE,SAASkB,EAAMC,GAAG,OAAOf,EAAG,SAAS,CAACO,IAAIQ,EAAEX,MAAM,CAAC,MAAQ,QAAQ,MAAQU,QAAWd,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,aAAa,CAACI,MAAM,CAAC,KAAO,eAAe,QAAU,CACljB,CACEY,OAAO,EACPC,MAAMrB,EAAIe,EAAE,2CAEd,CACEK,OAAO,EACPC,MAAMrB,EAAIe,EAAE,+CAEbO,MAAM,CAACF,MAAOpB,EAAqB,kBAAEuB,SAAS,SAAUC,GAAMxB,EAAIyB,kBAAkBD,GAAKE,WAAW,uBAAuBtB,EAAG,SAAS,CAACE,YAAY,iBAAiBqB,MAAM,CAAC,UAAa3B,EAAIyB,mBAAmBjB,MAAM,CAAC,QAAUR,EAAI4B,gBAAgBN,MAAM,CAACF,MAAOpB,EAAmB,gBAAEuB,SAAS,SAAUC,GAAMxB,EAAI6B,gBAAgBL,GAAKE,WAAW,sBAAsB,KAAKV,OAAM,MAAS,CAACZ,EAAG,MAAM,CAACE,YAAY,UAAUE,MAAM,CAAC,KAAO,WAAWsB,KAAK,WAAW,CAAC1B,EAAG,SAAS,CAACE,YAAY,2BAA2ByB,GAAG,CAAC,MAAQ/B,EAAIgC,QAAQ,CAAChC,EAAIa,GAAG,IAAIb,EAAIc,GAAGd,EAAIe,EAAE,mBAAmB,OAAOX,EAAG,cAAc,CAACI,MAAM,CAAC,KAAO,SAAS,UAAYR,EAAIyB,oBAAsBzB,EAAI6B,iBAAiBE,GAAG,CAAC,MAAQ/B,EAAIiC,WAAW,MAC/sBC,EAAkB,G,2ICCP,GACfC,YACAC,cACAC,kBACAC,YACAC,mBACAC,eAGAC,OACAC,SACAC,YACAC,mBACA,YAKAC,KAlBA,WAmBA,OACAhB,mBACAJ,qBACAqB,YAIAC,UACAnB,eADA,WAEA,wBACA,OACA,QACA,aACA,qBACA,YACA,mBACA,OACA,aACA,UACA,cASA,OANA,mBACAoB,sCAEAA,wCAGA,SAOA,yEAEA,kEAGAC,aAjCA,WAkCA,8BACA,CAGAC,qCACAC,mBAGA,CACAD,8BACAC,qBAMAC,QA5EA,WA6EA,iDAGAC,SACArB,MADA,WAEA,qBAGAC,OALA,SAKAqB,GAAA,2IACAC,EAAA,eADA,UAIA,iBAJA,uBAMAC,GAAA,+IAEAC,gEACAC,eACAR,0EAVA,SAaA,iBAbA,+CAeA,gDAfA,QAiBAI,MACA,UAlBA,qDAoBA,8BACAA,MArBA,+DChG8V,I,wBCQ1VK,EAAY,eACd,EACA5D,EACAmC,GACA,EACA,KACA,WACA,MAIa,aAAAyB,E,kECnBf","file":"js/dialog27.7a7d4d8a.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Card',{staticClass:\"prompt-rotate\",style:({'height':'100%'}),attrs:{\"show-highlight-border\":false},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('h3',[_vm._v(_vm._s(_vm.t('cluster.rotateCertificates.modalTitle')))])]},proxy:true},{key:\"body\",fn:function(){return [_vm._l((_vm.errors),function(error,i){return _c('Banner',{key:i,attrs:{\"color\":\"error\",\"label\":error}})}),_c('div',{staticClass:\"options\"},[_c('RadioGroup',{attrs:{\"name\":\"service-mode\",\"options\":[\n          {\n            value: true,\n            label:_vm.t('cluster.rotateCertificates.allServices')\n          },\n          {\n            value: false,\n            label:_vm.t('cluster.rotateCertificates.selectService')\n          }\n        ]},model:{value:(_vm.rotateAllServices),callback:function ($$v) {_vm.rotateAllServices=$$v},expression:\"rotateAllServices\"}}),_c('Select',{staticClass:\"service-select\",class:{'invisible': _vm.rotateAllServices},attrs:{\"options\":_vm.serviceOptions},model:{value:(_vm.selectedService),callback:function ($$v) {_vm.selectedService=$$v},expression:\"selectedService\"}})],1)]},proxy:true}])},[_c('div',{staticClass:\"buttons\",attrs:{\"slot\":\"actions\"},slot:\"actions\"},[_c('button',{staticClass:\"btn role-secondary mr-20\",on:{\"click\":_vm.close}},[_vm._v(\" \"+_vm._s(_vm.t('generic.cancel'))+\" \")]),_c('AsyncButton',{attrs:{\"mode\":\"rotate\",\"disabled\":!_vm.rotateAllServices && !_vm.selectedService},on:{\"click\":_vm.rotate}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nimport { Card } from '@components/Card';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { Banner } from '@components/Banner';\n\nimport { RadioGroup } from '@components/Form/Radio';\nimport Select from '@shell/components/form/Select';\n\nimport { get, set } from '@shell/utils/object';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\n\nexport default {\n  components: {\n    Select,\n    RadioGroup,\n    Card,\n    AsyncButton,\n    Banner\n  },\n\n  props: {\n    cluster: {\n      type:    Object,\n      default: () => {\n        return {};\n      }\n    }\n  },\n\n  data() {\n    return {\n      selectedService:   '',\n      rotateAllServices: true,\n      errors:            []\n    };\n  },\n\n  computed: {\n    serviceOptions() {\n      if (this.cluster.isRke2) {\n        const options = [\n          'admin',\n          'api-server',\n          'controller-manager',\n          'scheduler',\n          'cloud-controller',\n          'etcd',\n          'auth-proxy',\n          'kubelet',\n          'kube-proxy'\n        ];\n\n        if ( this.cluster.isK3s ) {\n          options.push('k3s-controller', 'k3s-server');\n        } else {\n          options.push('rke2-controller', 'rke2-server');\n        }\n\n        return options.sort();\n      }\n      // For RKE1 clusters, Norman provides the list of service options:\n      // type RotateCertificateInput struct {\n      //   CACertificates bool     `json:\"caCertificates,omitempty\"`\n      //   Services       []string `json:\"services,omitempty\" norman:\"type=enum,options=etcd|kubelet|kube-apiserver|kube-proxy|kube-scheduler|kube-controller-manager\"`\n      // }\n      const schema = this.$store.getters['rancher/schemaFor']('rotatecertificateinput');\n\n      return get(schema, 'resourceFields.services.options') || [];\n    },\n\n    actionParams() {\n      if (this.rotateAllServices) {\n        return {\n          // To rotate all services, RKE1 clusters need services\n          // to be null, while RKE2 requires an empty array.\n          services:       this.cluster.isRke2 ? [] : null,\n          caCertificates: false,\n        };\n      } else {\n        return {\n          services:       this.selectedService,\n          caCertificates: false,\n        };\n      }\n    }\n  },\n\n  mounted() {\n    this.selectedService = this.serviceOptions[0] || '';\n  },\n\n  methods: {\n    close() {\n      this.$emit('close');\n    },\n\n    async rotate(buttonDone) {\n      const params = this.actionParams;\n\n      try {\n        if (this.cluster.isRke2) {\n        // The Steve API doesn't support actions, so for RKE2 cluster cert rotation, we patch the cluster.\n          const currentGeneration = this.cluster.spec?.rkeConfig?.rotateCertificates?.generation || 0;\n\n          set(this.cluster, 'spec.rkeConfig.rotateCertificates', {\n            generation: currentGeneration + 1,\n            services:   (this.selectedService && !this.rotateAllServices) ? [this.selectedService] : []\n          });\n\n          await this.cluster.save();\n        } else {\n          await this.cluster.mgmt.doAction('rotateCertificates', params);\n        }\n        buttonDone(true);\n        this.close();\n      } catch (err) {\n        this.errors = exceptionToErrorsArray(err);\n        buttonDone(false);\n      }\n    }\n  }\n};\n</script>\n\n<template>\n  <Card\n    class=\"prompt-rotate\"\n    :show-highlight-border=\"false\"\n    :style=\"{'height':'100%'}\"\n  >\n    <template #title>\n      <h3>{{ t('cluster.rotateCertificates.modalTitle') }}</h3>\n    </template>\n    <template #body>\n      <Banner\n        v-for=\"(error, i) in errors\"\n        :key=\"i\"\n        class=\"\"\n        color=\"error\"\n        :label=\"error\"\n      />\n      <div class=\"options\">\n        <RadioGroup\n          v-model=\"rotateAllServices\"\n          name=\"service-mode\"\n          :options=\"[\n            {\n              value: true,\n              label:t('cluster.rotateCertificates.allServices')\n            },\n            {\n              value: false,\n              label:t('cluster.rotateCertificates.selectService')\n            }\n          ]\"\n        />\n        <Select\n          v-model=\"selectedService\"\n          :options=\"serviceOptions\"\n          class=\"service-select\"\n          :class=\"{'invisible': rotateAllServices}\"\n        />\n      </div>\n    </template>\n    <div\n      slot=\"actions\"\n      class=\"buttons\"\n    >\n      <button\n        class=\"btn role-secondary mr-20\"\n        @click=\"close\"\n      >\n        {{ t('generic.cancel') }}\n      </button>\n      <AsyncButton\n        mode=\"rotate\"\n        :disabled=\"!rotateAllServices && !selectedService\"\n        @click=\"rotate\"\n      />\n    </div>\n  </Card>\n</template>\n\n<style lang='scss' scoped>\n  .prompt-rotate {\n    margin: 0;\n  }\n  .buttons {\n    display: flex;\n    justify-content: flex-end;\n    width: 100%;\n  }\n  .options {\n    display: flex;\n    flex-direction: column;\n\n    .service-select {\n      margin-left: 20px;\n      margin-top: 10px;\n      width: fit-content;\n      min-width: 260px;\n    }\n  }\n\n.rotate-modal ::v-deep.v--modal-box{\n  border:none;\n\n  & .card-container{\n    margin: 0;\n\n    & .card-wrap {\n      display:flex;\n      flex-direction:column;\n    }\n\n    & .card-body {\n      flex: 1;\n    }\n\n    & .card-actions{\n      align-self: center\n    };\n  }\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../node_modules/babel-loader/lib/index.js??ref--16-1!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../node_modules/babel-loader/lib/index.js??ref--16-1!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RotateCertificatesDialog.vue?vue&type=template&id=41281ab8&scoped=true&\"\nimport script from \"./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"\nexport * from \"./RotateCertificatesDialog.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RotateCertificatesDialog.vue?vue&type=style&index=0&id=41281ab8&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"41281ab8\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RotateCertificatesDialog.vue?vue&type=style&index=0&id=41281ab8&prod&lang=scss&scoped=true&\""],"sourceRoot":""}