(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/diagnostic"],{"15f1":function(t,e,n){},"35d9":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"title-block mt-20 mb-40"},[n("div",[n("AsyncButton",{staticClass:"mr-20",attrs:{mode:"timing"},on:{click:t.gatherResponseTimes}}),n("AsyncButton",{attrs:{mode:"diagnostic"},on:{click:t.promptDownload}})],1)]),n("div",{staticClass:"mb-40"},[n("h2",{staticClass:"mb-20"},[t._v(" "+t._s(t.t("about.diagnostic.systemInformation.subtitle"))+" ")]),n("table",{staticClass:"full-width"},[t._m(0),n("tbody",t._l(t.systemInformation,(function(e,o){return n("tr",{key:o},[e.value.length?[n("td",[t._v(t._s(e.label))]),n("td",[t._v(t._s(e.value))])]:t._e()],2)})),0)])]),n("div",{staticClass:"mb-40"},[n("h2",{staticClass:"mb-20"},[t._v(" "+t._s(t.t("about.diagnostic.resourceCounts",{count:t.clusterCount}))+" ")]),n("div",{staticClass:"resources-count-container"},t._l(t.finalCounts,(function(e){return n("table",{key:e.id,staticClass:"full-width"},[n("thead",{on:{click:function(n){return t.toggleTable(e.id)}}},[n("th",{attrs:{colspan:"4"}},[n("div",{staticClass:"cluster-row"},[n("span",[t._v("Cluster: "),n("b",[t._v(t._s(e.name))])]),n("span",[t._v("Namespace: "),n("b",[t._v(t._s(e.namespace))])]),n("span",[t._v("Total Resources: "),n("b",[t._v(t._s(t.sumResourceCount(e.counts)))])]),n("span",[t._v("Nodes: "),n("b",[t._v(t._s(t.nodeCount(e.counts)))])]),n("i",{staticClass:"icon",class:{"icon-chevron-down":!e.isTableVisible,"icon-chevron-up":e.isTableVisible}})])])]),n("tbody",{directives:[{name:"show",rawName:"v-show",value:e.isTableVisible,expression:"cluster.isTableVisible"}]},[t._m(1,!0),t._l(e.counts,(function(e){return n("tr",{key:e.resource},[e.count>0?[n("td",{attrs:{scope:"row"}},[t._v(" "+t._s(e.resource)+" ")]),n("td",[t._v(t._s(e.count))]),n("td",[t._v(t._s(e.durationMs||"-"))])]:t._e()],2)}))],2)])})),0)]),n("div",{staticClass:"mb-40"},[n("h2",{staticClass:"mb-20"},[t._v(" "+t._s(t.t("about.diagnostic.logs.subtitle"))+" ")]),n("ul",{staticClass:"logs-container"},t._l(t.latestLogs,(function(e){return n("li",{key:t.generateKey(e.timestamp),class:e.type},[n("span",{staticClass:"log-entry-type"},[t._v(t._s(e.type)+" :: ")]),t._l(e.data,(function(e,o){return n("span",{key:o},[t._v(t._s(e))])}))],2)})),0)]),n("PromptModal")],1)},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",[n("tr",[n("th",[t._v("Type")]),n("th",[t._v("Value")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",[n("th",[t._v(" Resource ")]),n("th",[t._v(" Count ")]),n("th",[t._v(" Resource Timing (ms) ")])])}],a=n("15fd"),i=n("ade3"),r=n("3835"),c=n("1da1"),u=n("a34a"),l=n.n(u),d=(n("96cf"),n("cf99"),n("8be0"),n("38aa"),n("0b7a"),n("a797"),n("e673"),n("a41c"),n("5986"),n("1d8f"),n("2b77"),n("431d"),n("b667"),n("ddc0"),n("fc12"),n("9d9d"),n("ede4"),n("bb4d"),n("824a"),n("9ce4"),n("13ec"),n("7e5b"),n("bcff"),n("a788")),m=n("67c9"),v=n("2abc"),p=n("576a"),f=n("2ade"),b=n("b25d"),h=["list"];function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){Object(i["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var w={name:"Diagnostic",layout:"plain",components:{AsyncButton:m["b"],PromptModal:v["a"]},fetch:function(){var t=this;return Object(c["a"])(l.a.mark((function e(){var n,o,s,a,i,r,c;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("management/findAll",{type:d["e"].RANCHER_CLUSTER});case 2:return n=e.sent,o=n.filter((function(t){var e;return null===(e=t.mgmt)||void 0===e?void 0:e.isReady})),s=Object(f["a"])(Object(f["b"])(o),t.$store),a=[],i=[],r=[],s.forEach((function(e,n){var o,r,c,u,l,m=t.$store.getters["management/byId"](d["x"].CLUSTER,e.metadata.name);a.push({id:e.id,name:(null===m||void 0===m||null===(o=m.spec)||void 0===o?void 0:o.displayName)||(null===(r=e.metadata)||void 0===r?void 0:r.name),namespace:null===(c=e.metadata)||void 0===c?void 0:c.namespace,capiId:null===(u=e.mgmt)||void 0===u?void 0:u.id,counts:null,isTableVisible:!(0!==n||1!==s.length)}),i.push(t.$store.dispatch("management/request",{url:"/k8s/clusters/".concat(null===(l=e.mgmt)||void 0===l?void 0:l.id,"/v1/counts")}))})),e.next=11,Promise.all(i);case 11:c=e.sent,c.forEach((function(t,e){var n,o,s=null===(n=t.data)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.counts;if(s){var i=[];Object.keys(s).forEach((function(t){var e,n;i[t]=null===(e=s[t].summary)||void 0===e?void 0:e.count,i.push({resource:t,count:(null===(n=s[t].summary)||void 0===n?void 0:n.count)||0})}));var c=Object(b["b"])(i,"count:desc");r=r.concat(c),r=Object(b["b"])(r,"count:desc"),r=r.splice(0,15),r.forEach((function(t,n){r[n].id=a[e].id,r[n].capiId=a[e].capiId})),a[e].counts=c}})),t.topTenForResponseTime=r,t.finalCounts=a;case 15:case"end":return e.stop()}}),e)})))()},data:function(){var t,e,n,o,s,a,i,r,c,u,l,d,m,v,p,f,b,h,g,y,w,_,C=null===(t=window)||void 0===t?void 0:t.navigator,T=C.userAgent,j=C.userAgentData,O=C.language,S=C.cookieEnabled,I=C.hardwareConcurrency,k=C.deviceMemory,D={browser:{label:this.t("about.diagnostic.systemInformation.browser"),value:this.t("about.diagnostic.systemInformation.browserInfo",{userAgent:T,language:O,cookieEnabled:S})},system:{label:this.t("about.diagnostic.systemInformation.system"),value:this.t("about.diagnostic.systemInformation.hardwareConcurrency",{hardwareConcurrency:I})},jsMemory:{label:this.t("about.diagnostic.systemInformation.jsMemory"),value:""}};(null!==j&&void 0!==j&&j.platform&&(D.system.value=D.system.value.concat(", ",this.t("about.diagnostic.systemInformation.os",{platform:j.platform}))),k&&(D.system.value=D.system.value.concat(", ",this.t("about.diagnostic.systemInformation.deviceMemory",{deviceMemory:k}))),null!==(e=window)&&void 0!==e&&null!==(n=e.performance)&&void 0!==n&&null!==(o=n.memory)&&void 0!==o&&o.jsHeapSizeLimit)&&(D.jsMemory.value+=this.t("about.diagnostic.systemInformation.memJsHeapLimit",{jsHeapSizeLimit:null===(v=window)||void 0===v||null===(p=v.performance)||void 0===p||null===(f=p.memory)||void 0===f?void 0:f.jsHeapSizeLimit}));null!==(s=window)&&void 0!==s&&null!==(a=s.performance)&&void 0!==a&&null!==(i=a.memory)&&void 0!==i&&i.totalJSHeapSize&&(D.jsMemory.value+=", ".concat(this.t("about.diagnostic.systemInformation.memTotalJsHeapSize",{totalJSHeapSize:null===(b=window)||void 0===b||null===(h=b.performance)||void 0===h||null===(g=h.memory)||void 0===g?void 0:g.totalJSHeapSize})));null!==(r=window)&&void 0!==r&&null!==(c=r.performance)&&void 0!==c&&null!==(u=c.memory)&&void 0!==u&&u.usedJSHeapSize&&(D.jsMemory.value+=", ".concat(this.t("about.diagnostic.systemInformation.memUsedJsHeapSize",{usedJSHeapSize:null===(y=window)||void 0===y||null===(w=y.performance)||void 0===w||null===(_=w.memory)||void 0===_?void 0:_.usedJSHeapSize})));return this.scrollLogsToBottom(),{systemInformation:D,topTenForResponseTime:null,responseTimes:null,finalCounts:null,includeResponseTimes:!0,storeMapping:null===(l=this.$store)||void 0===l||null===(d=l._modules)||void 0===d||null===(m=d.root)||void 0===m?void 0:m.state,latestLogs:console.logs}},watch:{latestLogs:function(){this.scrollLogsToBottom()}},computed:{clusterCount:function(){var t;return null===(t=this.finalCounts)||void 0===t?void 0:t.length}},methods:{scrollLogsToBottom:function(){this.$nextTick((function(){var t=document.querySelector(".logs-container");t.scrollTop=t.scrollHeight}))},generateKey:function(t){var e=1e4*Math.random();return"key_".concat(e,"_").concat(t)},downloadData:function(t){var e=(new Date).toLocaleDateString(),n=(new Date).toLocaleTimeString(),o="rancher-diagnostic-data-".concat(e,"-").concat(n.replaceAll(":","_"),".json"),s={systemInformation:this.systemInformation,logs:this.latestLogs,storeMapping:this.parseStoreData(this.storeMapping),resourceCounts:this.finalCounts,responseTimes:this.responseTimes};Object(p["a"])(o,JSON.stringify(s),"application/json").then((function(){return t(!0)})).catch((function(){return t(!1)}))},setResourceResponseTiming:function(t){var e=this;null===t||void 0===t||t.forEach((function(t){if("success"===t.outcome){var n,o=e.finalCounts.find((function(e){return e.capiId===t.item.capiId})),s=null===o||void 0===o||null===(n=o.counts)||void 0===n?void 0:n.findIndex((function(e){return e.resource===t.item.resource}));(s&&-1!==s||0===s)&&e.$set(null===o||void 0===o?void 0:o.counts[s],"durationMs",t.durationMs)}}))},sumResourceCount:function(t){return t.reduce((function(t,e){return t+e.count}),0)},nodeCount:function(t){var e,n=t.findIndex((function(t){return"node"===t.resource}));return null===(e=t[n])||void 0===e?void 0:e.count},toggleTable:function(t){var e=this.finalCounts.findIndex((function(e){return e.id===t}));this.finalCounts[e].isTableVisible=!this.finalCounts[e].isTableVisible},gatherResponseTimes:function(t){var e=this;return Object(c["a"])(l.a.mark((function n(){return l.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Promise.all(e.topTenForResponseTime.map((function(t){var n=Date.now();return e.$store.dispatch("management/request",{url:"/k8s/clusters/".concat(t.capiId,"/v1/").concat(t.resource)}).then((function(){return{outcome:"success",item:t,durationMs:Date.now()-n}})).catch((function(){return{outcome:"error",item:t,durationMs:Date.now()-n}}))}))).then((function(n){e.responseTimes=n,e.setResourceResponseTiming(n),t(!0)})).catch((function(){return t(!1)}));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))()},parseStoreData:function(t){var e=["aws","digitalocean","linode"],n=["management","rancher","cluster","harvester","epinio","elemental"],o={};return Object.entries(t).forEach((function(t){var s=Object(r["a"])(t,2),i=s[0],c=s[1];e.includes(i)||(n.includes(i)&&Object.keys(c.types||{}).length?(o[i]=y(y({},c),{},{types:{}}),Object.entries(c.types).forEach((function(t){var e=Object(r["a"])(t,2),n=e[0],s=e[1],c=s.list,u=Object(a["a"])(s,h);o[i].types[n]=y(y({},u),{},{count:c.length})}))):o[i]=c)})),o},promptDownload:function(t){this.responseTimes?this.downloadData(t):this.$store.dispatch("management/promptModal",{component:"DiagnosticTimingsDialog",componentProps:{downloadData:this.downloadData,gatherResponseTimes:this.gatherResponseTimes}}).then((function(){return t(!0)})).catch((function(){return t(!1)}))}}},_=w,C=(n("daa1"),n("0c7c")),T=Object(C["a"])(_,o,s,!1,null,"27a17022",null);e["default"]=T.exports},daa1:function(t,e,n){"use strict";n("15f1")}}]);
//# sourceMappingURL=diagnostic.23472263.js.map