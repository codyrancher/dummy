(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/rio/mesh"],{"17c9":function(e,t,n){"use strict";n("ffa8")},7320:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mesh"},[e._m(0),n("svg",{ref:"mesh",attrs:{id:"mesh"},on:{click:e.clicked}})])},a=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("header",[n("h1",[e._v("App Mesh")])])}],s=(n("b61e"),n("0b7a"),n("46d9"),n("13ec"),n("d323"),n("2869"),n("2909")),o=n("1da1"),c=n("a34a"),i=n.n(c),l=(n("96cf"),n("2b77"),n("cf99"),n("8be0"),n("a797"),n("e673"),n("a41c"),n("5986"),n("bb4d"),n("b667"),n("ddc0"),n("38aa"),n("1157")),u=n.n(l),p=n("2c94");function d(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw s}}}}function h(e,t){if(e){if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var m=5,v=1e4;function g(e){return"".concat(e.namespace,":").concat(e.app,"@").concat(e.version)}function y(e){return"".concat(e.fromNamespace,":").concat(e.fromApp,"@").concat(e.fromVersion)}function w(e){return"".concat(e.toNamespace,":").concat(e.toApp,"@").concat(e.toVersion)}function b(e){return k.apply(this,arguments)}function k(){return k=Object(o["a"])(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.dispatch("rancher/request",{url:"/v1-metrics/meshsummary"});case 2:return n=e.sent,r={},n.nodes=n.nodes.filter((function(e){return!!e.app&&!!e.namespace})),n.nodes.forEach((function(e){e.id=g(e),r[e.id]=!0})),n.edges=n.edges.filter((function(e){return r[y(e)]&&r[w(e)]})),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function x(e){return e?e>100?Math.round(e):e>10?Math.round(10*e)/10:Math.round(100*e)/100:0}var G={asyncData:function(e){return Object(o["a"])(i.a.mark((function t(){var n,r;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.store,t.next=3,b(n);case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})))()},computed:{namespaces:function(){return this.$store.getters["namespaces"]()},displayNodes:function(){console.log("get displayNodes");var e=this.namespaces,t=this.nodes.filter((function(t){return e[t.namespace]}));return t},displayEdges:function(){console.log("get displayEdges");var e=this.namespaces,t=this.edges.filter((function(t){var n=t.fromNamespace,r=t.toNamespace;return e[n]&&e[r]}));return t}},watch:{nodes:function(){console.log("nodes updated"),this.updateGraph(),this.renderGraph()},namespaces:function(){console.log("namespaces updated"),this.updateGraph(),this.renderGraph()},edges:function(){console.log("edges updated"),this.updateGraph(),this.renderGraph()}},mounted:function(){var e=this;return Object(o["a"])(i.a.mark((function t(){return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Mounted"),e.timer=setInterval((function(){console.log("Timer"),e.refreshData()}),v),t.next=4,e.initGraph();case 4:e.updateGraph(),e.renderGraph(),window.m=e;case 7:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){clearInterval(this.timer)},methods:{refreshData:function(){var e=this;return Object(o["a"])(i.a.mark((function t(){var n;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Refreshing..."),t.next=3,b(e.$store);case 3:n=t.sent,e.nodes=n.nodes,e.edges=n.edges,console.log("Refreshed");case 7:case"end":return t.stop()}}),t)})))()},initGraph:function(){var e=this;return Object(o["a"])(i.a.mark((function t(){var r,a,s,o,c,l,u;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.e("chunk-2d0df2e1").then(n.bind(null,"898b"));case 2:return r=t.sent,t.next=5,n.e("chunk-25bb106c").then(n.t.bind(null,"1226",7));case 5:a=t.sent,s=new a.graphlib.Graph({compound:!0}),s.setGraph({marginx:0,marginy:0,rankdir:"LR",align:"UL",ranker:"longest-path"}),s.setDefaultEdgeLabel((function(){return{}})),o=new a.render,o.arrows().smaller=function(e,t,n,r){var s=e.append("marker").attr("id",t).attr("viewBox","0 0 12 12").attr("refX",6).attr("refY",6).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto"),o=s.append("path").attr("class","arrowhead").attr("d","M 6 0 L 0 6 L 6 12 L 12 6 z").style("stroke-width",1).style("stroke-dasharray","1,0");a.util.applyStyle(o,n["".concat(r,"Style")])},c=r.select(e.$refs.mesh),l=c.append("g"),u=r.zoom().on("zoom",(function(){r.event.sourceEvent&&(e.lastZoom=r.event.transform),l.attr("transform",r.event.transform)})),c.call(u),e.d3=r,e.dagreD3=a,e.graph=s,e.render=o,e.group=l,e.zoom=u;case 21:case"end":return t.stop()}}),t)})))()},updateGraph:function(){console.log("Updating...");var e,t=p["g"],n=this.graph,r={},a=d(this.displayNodes);try{for(a.s();!(e=a.n()).done;){var o=e.value,c=j(o.namespace),i=g(o);o.label="".concat(o.app,"@").concat(o.version);var l=o.stats.p99ms,u="ms";l>1e3&&(l/=1e3,u="s");var h='\n          <div class="version">\n            <h4>'.concat(t(o.app),"@").concat(t(o.version),'</h4>\n            <div class="row">\n              <div class="col span-4 sr">\n                <span>').concat(x(100*o.stats.successRate),'</span><span class="unit">%</span>\n              </div>\n              <div class="col span-4 rps">\n                <span>').concat(x(o.stats.rps),'</span>\n              </div>\n              <div class="col span-4 p99">\n                <span>').concat(x(l),'</span><span class="unit">').concat(u,"</span>\n              </div>\n            </div>\n          </div>\n        ");n.setNode(i,{labelType:"html",label:h,width:158,height:80,rx:m,ry:m}),n.setParent(i,c)}}catch(E){a.e(E)}finally{a.f()}var f,v=this.displayEdges.map((function(e){return e.stats.rps})),b=Math.min.apply(Math,Object(s["a"])(v)),k=Math.max.apply(Math,Object(s["a"])(v)),G=d(this.displayEdges);try{for(G.s();!(f=G.n()).done;){var M=f.value;j(M.fromNamespace),j(M.toNamespace);var N=Math.floor(4*(M.stats.rps-b)/(k-b))+1;n.setEdge(y(M),w(M),{arrowhead:"smaller",arrowheadClass:"arrowhead",class:"weight".concat(N),curve:this.d3.curveBasis,weight:N})}}catch(E){G.e(E)}finally{G.f()}function j(e){var t="ns:".concat(e);return r[e]||(r[e]=!0,n.setNode(t,{label:"Namespace: ".concat(e),clusterLabelPos:"top",rx:m,ry:m})),t}},renderGraph:function(){console.log("Rendering...");var e=this.d3,t=this.d3.select(this.$refs.mesh),n=this.group,r=this.graph,a=this.render,s=this.zoom;t.call(s.transform,e.zoomIdentity.translate(0,0).scale(1)),a(n,r);var o=r.graph().width,c=r.graph().height,i=parseInt(t.style("width").replace(/px/,"")),l=parseInt(t.style("height").replace(/px/,"")),u=Math.min(i/o,l/c),p=i/2-o*u/2,d=l/2-c*u/2;console.log("render"),this.lastZoom?t.call(s.transform,e.zoomIdentity.translate(this.lastZoom.x,this.lastZoom.y).scale(this.lastZoom.k)):t.call(s.transform,e.zoomIdentity.translate(p,d).scale(u)),this.loading=!1},clicked:function(e){var t=u()(e.target).closest(".edgePath");console.log(t)}}},M=G,N=(n("17c9"),n("0c7c")),j=Object(N["a"])(M,r,a,!1,null,null,null);t["default"]=j.exports},ffa8:function(e,t,n){}}]);
//# sourceMappingURL=mesh.72717249.js.map