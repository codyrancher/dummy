(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/auth/login"],{"0a73":function(e,t,s){"use strict";s("722e")},"45ab":function(e,t,s){},"722e":function(e,t,s){},9232:function(e,t,s){"use strict";var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",["login"===e.mode?s("div",[e.showLocale?s("div",[s("v-popover",{attrs:{"popover-class":"localeSelector",placement:"top",trigger:"click"}},[s("a",{staticClass:"locale-chooser",attrs:{"data-testid":"locale-selector"}},[e._v(" "+e._s(e.selectedLocaleLabel)+" "),s("i",{staticClass:"icon icon-fw icon-sort-down"})]),s("template",{slot:"popover"},[s("ul",{staticClass:"list-unstyled dropdown",staticStyle:{margin:"-1px"}},[e.showNone?s("li",{directives:[{name:"t",rawName:"v-t",value:"locale.none",expression:"'locale.none'"}],staticClass:"hand",on:{click:function(t){return e.switchLocale("none")}}}):e._e(),e._l(e.availableLocales,(function(t,r){return s("li",{key:r,staticClass:"hand",on:{click:function(t){return e.switchLocale(r)}}},[e._v(" "+e._s(t)+" ")])}))],2)])],2)],1):e._e()]):s("div",[s("Select",{attrs:{value:e.selectedOption,options:e.localesOptions},on:{input:function(t){return e.switchLocale(t)}}})],1)])},a=[],o=(s("13ec"),s("cf99"),s("8be0"),s("7e5b"),s("38aa"),s("bcff"),s("ade3")),n=(s("bb4d"),s("1d8f"),s("4d7f"),s("2f62")),c=s("c989");function i(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function l(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?i(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var u={name:"LocalSelector",components:{Select:c["a"]},props:{mode:{type:String,default:""}},computed:l(l({},Object(n["b"])("i18n",["selectedLocaleLabel","availableLocales"])),{},{localesOptions:function(){var e=this;return Object.keys(this.availableLocales).map((function(t){return{label:e.t("locale.".concat(t)),value:t}}))},selectedOption:function(){return Object.keys(this.availableLocales)[Object.values(this.availableLocales).indexOf(this.selectedLocaleLabel)]},showLocale:function(){return this.availableLocales&&Object.keys(this.availableLocales).length>1||this.dev},showNone:function(){return!1}}),methods:{switchLocale:function(e){this.$store.dispatch("i18n/switchTo",e)}}},d=u,p=(s("9c8a"),s("0c7c")),h=Object(p["a"])(d,r,a,!1,null,"1d201bdb",null);t["a"]=h.exports},"9c8a":function(e,t,s){"use strict";s("45ab")},d8eb:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"main-layout login"},[s("div",{staticClass:"row gutless mb-20"},[s("div",{staticClass:"col span-6 p-20"},[s("p",{staticClass:"text-center"},[e._v(" "+e._s(e.t("login.howdy"))+" ")]),s("h1",{staticClass:"text-center login-welcome"},[e._v(" "+e._s(e.t("login.welcome",{vendor:e.vendor}))+" ")]),s("div",{staticClass:"login-messages",class:{"login-messages--hasContent":e.hasLoginMessage}},[e.errorToDisplay?s("Banner",{attrs:{label:e.errorToDisplay,color:"error"}}):e.loggedOut?s("h4",{staticClass:"text-success text-center"},[e._v(" "+e._s(e.t("login.loggedOut"))+" ")]):e.timedOut?s("h4",{staticClass:"text-error text-center"},[e._v(" "+e._s(e.t("login.loginAgain"))+" ")]):e._e()],1),e.firstLogin?s("div",{staticClass:"first-login-message",attrs:{"data-testid":"first-login-message"}},[s("InfoBox",{attrs:{color:"info"}},[s("t",{attrs:{k:"setup.defaultPassword.intro",raw:!0}}),s("div",[s("t",{attrs:{k:"setup.defaultPassword.dockerPrefix",raw:!0}})],1),s("ul",[s("li",[s("t",{attrs:{k:"setup.defaultPassword.dockerPs",raw:!0}})],1),s("li",[s("CopyCode",[e._v(" docker logs "),s("u",[e._v("container-id")]),e._v(' 2>&1 | grep "Bootstrap Password:" ')])],1)]),s("div",[s("t",{attrs:{k:"setup.defaultPassword.dockerSuffix",raw:!0}})],1),s("br"),s("div",[s("t",{attrs:{k:"setup.defaultPassword.helmPrefix",raw:!0}})],1),s("br"),s("CopyCode",[e._v(" "+e._s(e.kubectlCmd)+" ")]),s("br"),s("div",[s("t",{attrs:{k:"setup.defaultPassword.helmSuffix",raw:!0}})],1)],1)],1):e._e(),(!e.hasLocal||e.hasLocal&&!e.showLocal)&&e.providers.length?s("div",{class:{"mt-30":!e.hasLoginMessage}},e._l(e.providers,(function(t,r){return s(e.providerComponents[r],{key:t,tag:"component",staticClass:"mb-10",attrs:{"focus-on-mount":0===r&&!e.showLocal,name:t,open:!e.showLocal},on:{showInputs:function(t){e.showLocal=!1},error:e.handleProviderError}})})),1):e._e(),e.hasLocal?[e.showLocal?s("form",{class:{"mt-30":!e.hasLoginMessage}},[s("div",{staticClass:"span-6 offset-3"},[s("div",{staticClass:"mb-20"},[e.firstLogin?e._e():s("LabeledInput",{ref:"username",attrs:{id:"username","data-testid":"local-login-username",label:e.t("login.username"),autocomplete:"username"},model:{value:e.username,callback:function(t){e.username="string"===typeof t?t.trim():t},expression:"username"}})],1),s("div",{},[s("Password",{ref:"password",attrs:{id:"password","data-testid":"local-login-password",label:e.t("login.password"),autocomplete:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)]),s("div",{staticClass:"mt-20"},[s("div",{staticClass:"col span-12 text-center"},[s("AsyncButton",{attrs:{id:"submit","data-testid":"login-submit",type:"submit","action-label":e.t("login.loginWithLocal"),"waiting-label":e.t("login.loggingIn"),"success-label":e.t("login.loggedIn"),"error-label":e.t("asyncButton.default.error")},on:{click:e.loginLocal}}),e.firstLogin?e._e():s("div",{staticClass:"mt-20"},[s("Checkbox",{attrs:{label:e.t("login.remember.label"),type:"checkbox"},model:{value:e.remember,callback:function(t){e.remember=t},expression:"remember"}})],1)],1)])]):e._e(),e.hasLocal&&!e.showLocal?s("div",{staticClass:"mt-20 text-center"},[s("a",{attrs:{id:"login-useLocal","data-testid":"login-useLocal",role:"button"},on:{click:e.toggleLocal}},[e._v(" "+e._s(e.t("login.useLocal"))+" ")])]):e._e(),e.hasLocal&&e.showLocal&&e.providers.length?s("div",{staticClass:"mt-20 text-center"},[s("a",{attrs:{role:"button"},on:{click:e.toggleLocal}},[e._v(" "+e._s(e.nonLocalPrompt)+" ")])]):e._e(),s("div",{staticClass:"locale-elector"},[s("LocaleSelector",{attrs:{mode:"login"}})],1)]:e._e()],2),s("BrandImage",{staticClass:"col span-6 landscape",attrs:{"file-name":"login-landscape.svg"}})],1)])},a=[],o=(s("1d8f"),s("13ec"),s("cf99"),s("7e5b"),s("38aa"),s("bcff"),s("ade3")),n=s("1da1"),c=s("a34a"),i=s.n(c),l=(s("96cf"),s("bb4d"),s("9ce4"),s("6d55"),s("9d9d"),s("8be0"),s("2b77"),s("b667"),s("ddc0"),s("f303")),u=s("a20e"),d=s("84d3"),p=s("67c9"),h=s("9232"),g=s("a4ed"),f=s("08ed"),b=s("18fe"),m=s("bec1"),v=s("fa3b"),w=s("4de2"),O=s("f441"),L=s("b25d"),y=s("bb49"),x=s("2f62"),j=s("5494"),_=s("c3e3"),k=s("a788"),P=s("c5b9"),C=s("3589"),S=s("58ec"),E=s("6fc2");function I(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function N(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?I(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):I(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var T={name:"Login",layout:"unauthenticated",components:{LabeledInput:d["a"],AsyncButton:p["b"],Checkbox:w["a"],BrandImage:g["a"],Banner:m["a"],InfoBox:f["a"],CopyCode:b["a"],Password:O["a"],LocaleSelector:h["a"]},asyncData:function(e){return Object(n["a"])(i.a.mark((function t(){var s,r,a,o,n,c,u,d,p,h,g,f,b,m;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.route,e.redirect,c=e.store,t.next=3,c.dispatch("auth/getAuthProviders");case 3:return u=t.sent,d=Object(L["b"])(u.map((function(e){return e.id})),["id"]),p=d.includes("local"),h=p&&!!d.find((function(e){return"local"!==e})),p&&Object(l["j"])(d,"local"),t.prev=8,t.next=11,c.dispatch("management/findAll",{type:k["x"].SETTING,opt:{load:_["a"],url:"/v1/".concat(k["x"].SETTING),redirectUnauthorized:!1}});case 11:g=c.getters["management/byId"](k["x"].SETTING,P["c"].FIRST_LOGIN),f=c.getters["management/byId"](k["x"].SETTING,P["c"].PL),b=c.getters["management/byId"](k["x"].SETTING,P["c"].BRAND),t.next=27;break;case 16:return t.prev=16,t.t0=t["catch"](8),t.next=20,c.dispatch("rancher/find",{type:"setting",id:P["c"].FIRST_LOGIN,opt:{url:"/v3/settings/".concat(P["c"].FIRST_LOGIN)}});case 20:return g=t.sent,t.next=23,c.dispatch("rancher/find",{type:"setting",id:P["c"].PL,opt:{url:"/v3/settings/".concat(P["c"].PL)}});case 23:return f=t.sent,t.next=26,c.dispatch("rancher/find",{type:"setting",id:P["c"].BRAND,opt:{url:"/v3/settings/".concat(P["c"].BRAND)}});case 26:b=t.sent;case 27:return null!==(s=f.value)&&void 0!==s&&s.length&&f.value!==Object(S["d"])()&&Object(S["f"])(f.value),null!==(r=b)&&void 0!==r&&null!==(a=r.value)&&void 0!==a&&a.length&&b.value!==Object(S["b"])()&&Object(S["e"])(b.value),1===d.length&&(m=d[0]),t.abrupt("return",{vendor:Object(S["d"])(),providers:d,hasOthers:h,hasLocal:p,showLocal:!h||n.query[v["q"]]===v["M"],firstLogin:"true"===(null===(o=g)||void 0===o?void 0:o.value),singleProvider:m});case 31:case"end":return t.stop()}}),t,null,[[8,16]])})))()},data:function(e){var t=e.$cookies,s=t.get(u["c"],{parseJSON:!1})||"";return{product:Object(S["c"])(),username:s,remember:!!s,password:"",timedOut:this.$route.query[v["E"]]===v["M"],loggedOut:this.$route.query[v["r"]]===v["M"],err:this.$route.query.err,providers:[],providerComponents:[],customLoginError:{}}},computed:N(N({},Object(x["b"])({t:"i18n/t"})),{},{nonLocalPrompt:function(){if(this.singleProvider){var e=this.displayName(this.singleProvider);return this.t("login.useProvider",{provider:e})}return this.t("login.useNonLocal")},errorMessage:function(){return this.err===C["LOGIN_ERRORS"].CLIENT_UNAUTHORIZED?this.t("login.clientError"):this.err===C["LOGIN_ERRORS"].CLIENT||this.err===C["LOGIN_ERRORS"].SERVER?this.t("login.error"):this.err},errorToDisplay:function(){var e,t;return"true"===(null===(e=this.customLoginError)||void 0===e?void 0:e.showMessage)&&null!==(t=this.customLoginError)&&void 0!==t&&t.message&&this.errorMessage?"".concat(this.customLoginError.message," \n ").concat(this.errorMessage):this.errorMessage?this.errorMessage:""},kubectlCmd:function(){return"kubectl get secret --namespace cattle-system bootstrap-secret -o go-template='{{.data.bootstrapPassword|base64decode}}{{\"\\n\"}}'"},hasLoginMessage:function(){return this.errorToDisplay||this.loggedOut||this.timedOut}}),created:function(){this.providerComponents=this.providers.map((function(e){return Object(j["h"])(y["configType"][e])}))},fetch:function(){var e=this;return Object(n["a"])(i.a.mark((function t(){var s,r;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("management/find",{type:k["x"].SETTING,id:P["c"].BANNERS});case 2:s=t.sent,r=s.value,e.customLoginError=JSON.parse(r).loginError;case 5:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this;this.username=this.firstLogin?"admin":this.username,this.$nextTick((function(){e.focusSomething()}))},methods:{displayName:function(e){return this.t("model.authConfig.provider.".concat(e))},toggleLocal:function(){var e=this;this.showLocal=!this.showLocal,this.$router.applyQuery(Object(o["a"])({},v["q"],v["M"])),this.$nextTick((function(){e.focusSomething()}))},focusSomething:function(){var e,t;this.showLocal&&(t=this.username?this.$refs.password:this.$refs.username,null!==(e=t)&&void 0!==e&&e.focus&&(t.focus(),t.select&&t.select()))},handleProviderError:function(e){this.err=e},loginLocal:function(e){var t=this;return Object(n["a"])(i.a.mark((function s(){var r,a;return i.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.$store.dispatch("auth/login",{provider:"local",body:{username:t.username,password:t.password}});case 3:return s.next=5,t.$store.dispatch("rancher/findAll",{type:k["D"].USER,opt:{url:"/v3/users?me=true",load:_["b"]}});case 5:return a=s.sent,null!==a&&void 0!==a&&a[0]&&t.$store.dispatch("auth/gotUser",a[0]),t.remember?t.$cookies.set(u["c"],t.username,{encode:function(e){return e},maxAge:31536e3,path:"/",sameSite:!0,secure:!0}):t.$cookies.remove(u["c"]),s.next=10,Object(E["a"])({app:t.$store.app,store:t.$store,$plugin:t.$store.$plugin});case 10:t.firstLogin||null!==(r=a[0])&&void 0!==r&&r.mustChangePassword?(t.$store.dispatch("auth/setInitialPass",t.password),t.$router.push({name:"auth-setup"})):t.$router.replace("/"),s.next=19;break;case 13:s.prev=13,s.t0=s["catch"](0),t.err=s.t0,t.timedOut=null,t.loggedOut=null,e(!1);case 19:case"end":return s.stop()}}),s,null,[[0,13]])})))()}}},$=T,R=(s("0a73"),s("0c7c")),D=Object(R["a"])($,r,a,!1,null,"0fcdd5e6",null);t["default"]=D.exports}}]);
//# sourceMappingURL=login.091baaab.js.map