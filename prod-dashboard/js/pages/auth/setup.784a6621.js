(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/auth/setup"],{3462:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("form",{staticClass:"setup"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col span-6 form-col"},[s("div",[e._v(" Â  ")]),s("div",[s("h1",{staticClass:"text-center"},[e._v(" "+e._s(e.t("setup.welcome",{product:e.product}))+" ")]),e.mustChangePassword?[s("p",{staticClass:"text-center mb-20 mt-20 setup-title",domProps:{innerHTML:e._s(e.t(e.isFirstLogin?"setup.setPassword":"setup.newUserSetPassword",{username:e.username},!0))}}),e.haveCurrent?e._e():s("Password",{staticClass:"mb-20",attrs:{autocomplete:"current-password",type:"password",label:e.t("setup.currentPassword"),required:!0},model:{value:e.current,callback:function(t){e.current="string"===typeof t?t.trim():t},expression:"current"}}),s("input",{attrs:{type:"hidden",name:"username",autocomplete:"username"},domProps:{value:e.username}}),s("div",{staticClass:"mb-20"},[s("RadioGroup",{attrs:{"data-testid":"setup-password-mode",name:"password-mode",options:e.passwordOptions},model:{value:e.useRandom,callback:function(t){e.useRandom=t},expression:"useRandom"}})],1),s("div",{staticClass:"mb-20"},[e.useRandom?s("LabeledInput",{ref:"password",attrs:{type:e.useRandom?"text":"password",disabled:e.useRandom,"data-testid":"setup-password-random","label-key":"setup.newPassword"},scopedSlots:e._u([e.useRandom?{key:"suffix",fn:function(){return[s("div",{staticClass:"addon",staticStyle:{padding:"0 0 0 12px"}},[s("CopyToClipboard",{staticClass:"btn-sm",attrs:{text:e.password}})],1)]},proxy:!0}:null],null,!0),model:{value:e.password,callback:function(t){e.password="string"===typeof t?t.trim():t},expression:"password"}}):s("Password",{ref:"password",attrs:{label:e.t("setup.newPassword"),"data-testid":"setup-password",required:!0},model:{value:e.password,callback:function(t){e.password="string"===typeof t?t.trim():t},expression:"password"}})],1),s("Password",{directives:[{name:"show",rawName:"v-show",value:!e.useRandom,expression:"!useRandom"}],attrs:{autocomplete:"new-password","data-testid":"setup-password-confirm",label:e.t("setup.confirmPassword"),required:!0},model:{value:e.confirm,callback:function(t){e.confirm="string"===typeof t?t.trim():t},expression:"confirm"}})]:e._e(),e.isFirstLogin?[e.mcmEnabled?[e.mustChangePassword?s("hr",{staticClass:"mt-20 mb-20"}):e._e(),s("p",[s("t",{attrs:{k:"setup.serverUrl.tip",raw:!0}})],1),s("div",{staticClass:"mt-20"},[s("LabeledInput",{attrs:{label:e.t("setup.serverUrl.label"),"data-testid":"setup-server-url"},model:{value:e.serverUrl,callback:function(t){e.serverUrl=t},expression:"serverUrl"}})],1)]:e._e(),s("div",{staticClass:"checkbox mt-40"},[s("Checkbox",{attrs:{id:"checkbox-telemetry"},scopedSlots:e._u([{key:"label",fn:function(){return[s("t",{attrs:{k:"setup.telemetry",raw:!0,name:e.productName}})]},proxy:!0}],null,!1,1048729250),model:{value:e.telemetry,callback:function(t){e.telemetry=t},expression:"telemetry"}})],1),s("div",{staticClass:"checkbox pt-10 eula"},[s("Checkbox",{attrs:{id:"checkbox-eula","data-testid":"setup-agreement"},scopedSlots:e._u([{key:"label",fn:function(){return[s("t",{attrs:{k:"setup.eula",raw:!0,name:e.productName}})]},proxy:!0}],null,!1,3395104304),model:{value:e.eula,callback:function(t){e.eula=t},expression:"eula"}})],1)]:e._e(),s("div",{staticClass:"text-center mt-20",attrs:{id:"submit"}},[s("AsyncButton",{key:"passwordSubmit",attrs:{type:"submit",mode:"continue",disabled:!e.saveEnabled,"data-testid":"setup-submit"},on:{click:e.save}})],1),s("div",{staticClass:"setup-errors mt-20"},e._l(e.errors,(function(t){return s("h4",{key:t,staticClass:"text-error text-center"},[e._v(" "+e._s(t)+" ")])})),0)],2)]),s("div",{staticClass:"col span-6 landscape"})])])},r=[],n=s("b36b"),u=n["a"],o=(s("69e0"),s("0c7c")),c=Object(o["a"])(u,a,r,!1,null,"8de51302",null);t["default"]=c.exports},"69e0":function(e,t,s){"use strict";s("e8a6")},b36b:function(e,t,s){"use strict";(function(e){var a=s("1da1"),r=(s("a797"),s("8be0"),s("e673"),s("a41c"),s("5986"),s("b667"),s("ddc0"),s("a34a")),n=s.n(r),u=(s("96cf"),s("2c94")),o=s("84d3"),c=s("091e"),i=s("67c9"),l=s("fa3b"),d=s("a788"),p=s("f303"),m=s("4de2"),v=s("58ec"),b=s("fa35"),h=s("2f40"),f=s("c5b9"),w=s("c3e3"),x=s("55a3"),g=s("4579"),y=s("f441"),k=s("9bc6"),C=function(e){var t=e.getters["management/byId"](d["x"].SETTING,f["c"].FIRST_LOGIN);return"true"===(null===t||void 0===t?void 0:t.value)},E=function(){var e=Object(a["a"])(n.a.mark((function e(t){var s,a;return n.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.dispatch("auth/getUser");case 2:return a=null===(s=t.getters["auth/v3User"])||void 0===s?void 0:s.mustChangePassword,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t["a"]={layout:"unauthenticated",data:function(){return{passwordOptions:[{label:this.t("setup.useRandom"),value:!0},{label:this.t("setup.useManual"),value:!1}]}},middleware:function(e){return Object(a["a"])(n.a.mark((function t(){var s,a,r,u;return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=e.store,a=e.redirect,e.route,t.prev=1,t.next=4,s.dispatch("management/findAll",{type:d["x"].SETTING,opt:{load:w["a"],url:"/v1/".concat(d["x"].SETTING),redirectUnauthorized:!1}});case 4:t.next=8;break;case 6:t.prev=6,t.t0=t["catch"](1);case 8:return t.next=10,C(s);case 10:return r=t.sent,t.next=13,E(s);case 13:if(u=t.sent,!r){t.next=18;break}return t.abrupt("return");case 18:if(!u){t.next=24;break}if(!s.getters["auth/initialPass"]){t.next=21;break}return t.abrupt("return");case 21:return t.next=23,s.dispatch("auth/logout",null,{root:!0});case 23:return t.abrupt("return",a(302,"/auth/login?".concat(l["r"])));case 24:return t.abrupt("return",a("/"));case 25:case"end":return t.stop()}}),t,null,[[1,6]])})))()},components:{AsyncButton:i["b"],LabeledInput:o["a"],CopyToClipboard:c["a"],Checkbox:m["a"],RadioGroup:b["b"],Password:y["a"]},asyncData:function(t){return Object(a["a"])(n.a.mark((function s(){var a,r,o,c,i,m,b,h,g,y,k,R,T,P,I,O,_,S,U,j,L,N;return n.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return i=t.route,m=t.req,b=t.store,h=b.getters["management/byId"](d["x"].SETTING,f["c"].TELEMETRY),g=b.getters["management/byId"](d["x"].SETTING,f["c"].SERVER_URL),y=b.getters["management/byId"](d["x"].SETTING,f["c"].VERSION_RANCHER),k=!0,null!==h&&void 0!==h&&h.value&&"prompt"!==h.value?k="out"!==h.value:null!==y&&void 0!==y&&y.value&&!Object(x["c"])(null===y||void 0===y?void 0:y.value)||(k=!1),s.prev=6,s.next=9,b.dispatch("management/findAll",{type:d["x"].SETTING,opt:{load:w["a"],url:"/v1/".concat(d["x"].SETTING),redirectUnauthorized:!1}});case 9:R=b.getters["management/byId"](d["x"].SETTING,f["c"].PL),s.next=17;break;case 12:return s.prev=12,s.t0=s["catch"](6),s.next=16,b.dispatch("rancher/find",{type:"setting",id:f["c"].PL,opt:{url:"/v3/settings/".concat(f["c"].PL)}});case 16:R=s.sent;case 17:return null!==(a=R.value)&&void 0!==a&&a.length&&R.value!==Object(v["d"])()&&Object(v["f"])(R.value),T=R.default,s.next=21,b.dispatch("rancher/findAll",{type:d["D"].PRINCIPAL,opt:{url:"/v3/principals"}});case 21:return P=s.sent,I=Object(p["e"])(P,"me",!0),O=i.query[l["B"]]||b.getters["auth/initialPass"],_=null!==(r=b.getters["auth/v3User"])&&void 0!==r?r:{},s.next=27,b.dispatch("management/find",{type:d["x"].FEATURE,id:"multi-cluster-management",opt:{url:"/v1/".concat(d["x"].FEATURE,"/multi-cluster-management")}});case 27:return S=s.sent,U=(null===S||void 0===S||null===(o=S.spec)||void 0===o?void 0:o.value)||(null===S||void 0===S||null===(c=S.status)||void 0===c?void 0:c.default),j=null!==g&&void 0!==g&&g.value?g.value:e.server?m.headers.host:window.location.origin,s.next=32,C(b);case 32:return L=s.sent,s.next=35,E(b);case 35:return N=s.sent,s.abrupt("return",{productName:T,vendor:Object(v["d"])(),product:Object(v["c"])(),step:parseInt(i.query.step,10)||1,useRandom:!0,haveCurrent:!!O,username:(null===I||void 0===I?void 0:I.loginName)||"admin",isFirstLogin:L,mustChangePassword:N,current:O,password:Object(u["q"])(),confirm:"",v3User:_,serverUrl:j,mcmEnabled:U,telemetry:k,eula:!1,principals:P,errors:[]});case 37:case"end":return s.stop()}}),s,null,[[6,12]])})))()},computed:{saveEnabled:function(){if(!this.eula&&this.isFirstLogin)return!1;if(this.mustChangePassword){if(!this.current)return!1;if(!this.useRandom&&(!this.password||this.password!==this.confirm))return!1}return!0},me:function(){var e=Object(p["e"])(this.principals,"me",!0);return e}},watch:{useRandom:function(e){var t=this;e?this.password=Object(u["q"])():(this.password="",this.$nextTick((function(){t.$refs.password.focus()})))}},methods:{save:function(e){var t=this;return Object(a["a"])(n.a.mark((function s(){var a,r;return n.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return a=[],s.prev=1,s.next=4,Object(k["applyProducts"])(t.$store,t.$plugin);case 4:return s.next=6,t.$store.dispatch("loadManagement");case 6:if(!t.mustChangePassword){s.next=11;break}return s.next=9,t.$store.dispatch("rancher/request",{url:"/v3/users?action=changepassword",method:"post",data:{currentPassword:t.current,newPassword:t.password}});case 9:s.next=12;break;case 11:a.push(Object(h["c"])(t.$store,f["c"].FIRST_LOGIN,"false"));case 12:return r=t.v3User,r.mustChangePassword=!1,t.$store.dispatch("auth/gotUser",r),t.isFirstLogin&&(a.push(Object(h["c"])(t.$store,f["c"].EULA_AGREED,(new Date).toISOString())),a.push(Object(h["c"])(t.$store,f["c"].TELEMETRY,t.telemetry?"in":"out")),t.mcmEnabled&&t.serverUrl&&a.push(Object(h["c"])(t.$store,f["c"].SERVER_URL,t.serverUrl))),s.next=18,Promise.all(a);case 18:setTimeout((function(){e(!0),t.done()}),2e3),s.next=26;break;case 21:s.prev=21,s.t0=s["catch"](1),console.error(s.t0),e(!1),t.errors=Object(g["c"])(s.t0);case 26:case"end":return s.stop()}}),s,null,[[1,21]])})))()},done:function(){this.$router.replace("/")}}}}).call(this,s("4362"))},e8a6:function(e,t,s){}}]);
//# sourceMappingURL=setup.784a6621.js.map