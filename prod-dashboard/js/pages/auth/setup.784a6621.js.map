{"version":3,"sources":["webpack:///./shell/pages/auth/setup.vue?48c2","webpack:///./shell/pages/auth/setup.vue?0d68","webpack:///./shell/pages/auth/setup.vue","webpack:///./shell/pages/auth/setup.vue?09e4","webpack:///shell/pages/auth/setup.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","t","product","domProps","isFirstLogin","username","haveCurrent","_e","attrs","model","value","callback","$$v","current","trim","expression","passwordOptions","useRandom","ref","scopedSlots","_u","key","fn","staticStyle","password","proxy","directives","name","rawName","confirm","serverUrl","productName","telemetry","eula","saveEnabled","on","save","_l","err","staticRenderFns","component","store","out","layout","data","label","middleware","type","opt","load","url","redirectUnauthorized","calcIsFirstLogin","calcMustChangePassword","mustChangePassword","root","redirect","components","AsyncButton","LabeledInput","CopyToClipboard","Checkbox","RadioGroup","Password","asyncData","route","telemetrySetting","serverUrlSetting","rancherVersionSetting","plSetting","id","setVendor","principals","me","findBy","v3User","mcmFeature","mcmEnabled","vendor","step","errors","computed","watch","neu","methods","buttonCb","promises","applyProducts","method","currentPassword","newPassword","user","Promise","setTimeout","console","done"],"mappings":"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","file":"js/pages/auth/setup.784a6621.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('form',{staticClass:\"setup\"},[_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col span-6 form-col\"},[_c('div',[_vm._v(\" Â  \")]),_c('div',[_c('h1',{staticClass:\"text-center\"},[_vm._v(\" \"+_vm._s(_vm.t('setup.welcome', {product: _vm.product}))+\" \")]),(_vm.mustChangePassword)?[_c('p',{staticClass:\"text-center mb-20 mt-20 setup-title\",domProps:{\"innerHTML\":_vm._s(_vm.t(_vm.isFirstLogin ? 'setup.setPassword' : 'setup.newUserSetPassword', { username: _vm.username }, true))}}),(!_vm.haveCurrent)?_c('Password',{staticClass:\"mb-20\",attrs:{\"autocomplete\":\"current-password\",\"type\":\"password\",\"label\":_vm.t('setup.currentPassword'),\"required\":true},model:{value:(_vm.current),callback:function ($$v) {_vm.current=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"current\"}}):_vm._e(),_c('input',{attrs:{\"type\":\"hidden\",\"name\":\"username\",\"autocomplete\":\"username\"},domProps:{\"value\":_vm.username}}),_c('div',{staticClass:\"mb-20\"},[_c('RadioGroup',{attrs:{\"data-testid\":\"setup-password-mode\",\"name\":\"password-mode\",\"options\":_vm.passwordOptions},model:{value:(_vm.useRandom),callback:function ($$v) {_vm.useRandom=$$v},expression:\"useRandom\"}})],1),_c('div',{staticClass:\"mb-20\"},[(_vm.useRandom)?_c('LabeledInput',{ref:\"password\",attrs:{\"type\":_vm.useRandom ? 'text' : 'password',\"disabled\":_vm.useRandom,\"data-testid\":\"setup-password-random\",\"label-key\":\"setup.newPassword\"},scopedSlots:_vm._u([(_vm.useRandom)?{key:\"suffix\",fn:function(){return [_c('div',{staticClass:\"addon\",staticStyle:{\"padding\":\"0 0 0 12px\"}},[_c('CopyToClipboard',{staticClass:\"btn-sm\",attrs:{\"text\":_vm.password}})],1)]},proxy:true}:null],null,true),model:{value:(_vm.password),callback:function ($$v) {_vm.password=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"password\"}}):_c('Password',{ref:\"password\",attrs:{\"label\":_vm.t('setup.newPassword'),\"data-testid\":\"setup-password\",\"required\":true},model:{value:(_vm.password),callback:function ($$v) {_vm.password=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"password\"}})],1),_c('Password',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.useRandom),expression:\"!useRandom\"}],attrs:{\"autocomplete\":\"new-password\",\"data-testid\":\"setup-password-confirm\",\"label\":_vm.t('setup.confirmPassword'),\"required\":true},model:{value:(_vm.confirm),callback:function ($$v) {_vm.confirm=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"confirm\"}})]:_vm._e(),(_vm.isFirstLogin)?[(_vm.mcmEnabled)?[(_vm.mustChangePassword)?_c('hr',{staticClass:\"mt-20 mb-20\"}):_vm._e(),_c('p',[_c('t',{attrs:{\"k\":\"setup.serverUrl.tip\",\"raw\":true}})],1),_c('div',{staticClass:\"mt-20\"},[_c('LabeledInput',{attrs:{\"label\":_vm.t('setup.serverUrl.label'),\"data-testid\":\"setup-server-url\"},model:{value:(_vm.serverUrl),callback:function ($$v) {_vm.serverUrl=$$v},expression:\"serverUrl\"}})],1)]:_vm._e(),_c('div',{staticClass:\"checkbox mt-40\"},[_c('Checkbox',{attrs:{\"id\":\"checkbox-telemetry\"},scopedSlots:_vm._u([{key:\"label\",fn:function(){return [_c('t',{attrs:{\"k\":\"setup.telemetry\",\"raw\":true,\"name\":_vm.productName}})]},proxy:true}],null,false,1048729250),model:{value:(_vm.telemetry),callback:function ($$v) {_vm.telemetry=$$v},expression:\"telemetry\"}})],1),_c('div',{staticClass:\"checkbox pt-10 eula\"},[_c('Checkbox',{attrs:{\"id\":\"checkbox-eula\",\"data-testid\":\"setup-agreement\"},scopedSlots:_vm._u([{key:\"label\",fn:function(){return [_c('t',{attrs:{\"k\":\"setup.eula\",\"raw\":true,\"name\":_vm.productName}})]},proxy:true}],null,false,3395104304),model:{value:(_vm.eula),callback:function ($$v) {_vm.eula=$$v},expression:\"eula\"}})],1)]:_vm._e(),_c('div',{staticClass:\"text-center mt-20\",attrs:{\"id\":\"submit\"}},[_c('AsyncButton',{key:\"passwordSubmit\",attrs:{\"type\":\"submit\",\"mode\":\"continue\",\"disabled\":!_vm.saveEnabled,\"data-testid\":\"setup-submit\"},on:{\"click\":_vm.save}})],1),_c('div',{staticClass:\"setup-errors mt-20\"},_vm._l((_vm.errors),function(err){return _c('h4',{key:err,staticClass:\"text-error text-center\"},[_vm._v(\" \"+_vm._s(err)+\" \")])}),0)],2)]),_c('div',{staticClass:\"col span-6 landscape\"})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../../node_modules/babel-loader/lib/index.js??ref--16-1!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./setup.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../../node_modules/babel-loader/lib/index.js??ref--16-1!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./setup.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./setup.vue?vue&type=template&id=8de51302&scoped=true&\"\nimport script from \"./setup.vue?vue&type=script&lang=js&\"\nexport * from \"./setup.vue?vue&type=script&lang=js&\"\nimport style0 from \"./setup.vue?vue&type=style&index=0&id=8de51302&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"8de51302\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./setup.vue?vue&type=style&index=0&id=8de51302&prod&lang=scss&scoped=true&\"","<script>\nimport { randomStr } from '@shell/utils/string';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport CopyToClipboard from '@shell/components/CopyToClipboard';\nimport AsyncButton from '@shell/components/AsyncButton';\nimport { LOGGED_OUT, SETUP } from '@shell/config/query-params';\nimport { NORMAN, MANAGEMENT } from '@shell/config/types';\nimport { findBy } from '@shell/utils/array';\nimport { Checkbox } from '@components/Form/Checkbox';\nimport { getVendor, getProduct, setVendor } from '@shell/config/private-label';\nimport { RadioGroup } from '@components/Form/Radio';\nimport { setSetting } from '@shell/utils/settings';\nimport { SETTING } from '@shell/config/settings';\nimport { _ALL_IF_AUTHED } from '@shell/plugins/dashboard-store/actions';\nimport { isDevBuild } from '@shell/utils/version';\nimport { exceptionToErrorsArray } from '@shell/utils/error';\nimport Password from '@shell/components/form/Password';\nimport { applyProducts } from '@shell/store/type-map';\n\nconst calcIsFirstLogin = (store) => {\n  const firstLoginSetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.FIRST_LOGIN);\n\n  return firstLoginSetting?.value === 'true';\n};\n\nconst calcMustChangePassword = async(store) => {\n  await store.dispatch('auth/getUser');\n\n  const out = store.getters['auth/v3User']?.mustChangePassword;\n\n  return out;\n};\n\nexport default {\n  layout: 'unauthenticated',\n\n  data() {\n    return {\n      passwordOptions: [\n        { label: this.t('setup.useRandom'), value: true },\n        { label: this.t('setup.useManual'), value: false }],\n    };\n  },\n\n  async middleware({ store, redirect, route } ) {\n    try {\n      await store.dispatch('management/findAll', {\n        type: MANAGEMENT.SETTING,\n        opt:  {\n          load: _ALL_IF_AUTHED, url: `/v1/${ MANAGEMENT.SETTING }`, redirectUnauthorized: false\n        }\n      });\n    } catch (e) {\n    }\n\n    const isFirstLogin = await calcIsFirstLogin(store);\n    const mustChangePassword = await calcMustChangePassword(store);\n\n    if (isFirstLogin) {\n      // Always show setup if this is the first log in\n      return;\n    } else if (mustChangePassword) {\n      // If the password needs changing and this isn't the first log in ensure we have the password\n      if (!!store.getters['auth/initialPass']) {\n        // Got it... show setup\n        return;\n      }\n      // Haven't got it... redirect to log in so we get it\n      await store.dispatch('auth/logout', null, { root: true });\n\n      return redirect(302, `/auth/login?${ LOGGED_OUT }`);\n    }\n\n    // For all other cases we don't need to show setup\n    return redirect('/');\n  },\n\n  components: {\n    AsyncButton, LabeledInput, CopyToClipboard, Checkbox, RadioGroup, Password\n  },\n\n  async asyncData({ route, req, store }) {\n    const telemetrySetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.TELEMETRY);\n    const serverUrlSetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.SERVER_URL);\n    const rancherVersionSetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.VERSION_RANCHER);\n    let telemetry = true;\n\n    if (telemetrySetting?.value && telemetrySetting.value !== 'prompt') {\n      telemetry = telemetrySetting.value !== 'out';\n    } else if (!rancherVersionSetting?.value || isDevBuild(rancherVersionSetting?.value)) {\n      telemetry = false;\n    }\n\n    let plSetting;\n\n    try {\n      await store.dispatch('management/findAll', {\n        type: MANAGEMENT.SETTING,\n        opt:  {\n          load: _ALL_IF_AUTHED, url: `/v1/${ MANAGEMENT.SETTING }`, redirectUnauthorized: false\n        },\n      });\n\n      plSetting = store.getters['management/byId'](MANAGEMENT.SETTING, SETTING.PL);\n    } catch (e) {\n      // Older versions used Norman API to get these\n      plSetting = await store.dispatch('rancher/find', {\n        type: 'setting',\n        id:   SETTING.PL,\n        opt:  { url: `/v3/settings/${ SETTING.PL }` }\n      });\n    }\n\n    if (plSetting.value?.length && plSetting.value !== getVendor()) {\n      setVendor(plSetting.value);\n    }\n\n    const productName = plSetting.default;\n\n    const principals = await store.dispatch('rancher/findAll', { type: NORMAN.PRINCIPAL, opt: { url: '/v3/principals' } });\n    const me = findBy(principals, 'me', true);\n\n    const current = route.query[SETUP] || store.getters['auth/initialPass'];\n    const v3User = store.getters['auth/v3User'] ?? {};\n\n    const mcmFeature = await store.dispatch('management/find', {\n      type: MANAGEMENT.FEATURE, id: 'multi-cluster-management', opt: { url: `/v1/${ MANAGEMENT.FEATURE }/multi-cluster-management` }\n    });\n\n    const mcmEnabled = mcmFeature?.spec?.value || mcmFeature?.status?.default;\n\n    let serverUrl;\n\n    if (serverUrlSetting?.value) {\n      serverUrl = serverUrlSetting.value;\n    } else if ( process.server ) {\n      serverUrl = req.headers.host;\n    } else {\n      serverUrl = window.location.origin;\n    }\n\n    const isFirstLogin = await calcIsFirstLogin(store);\n    const mustChangePassword = await calcMustChangePassword(store);\n\n    return {\n      productName,\n      vendor:  getVendor(),\n      product: getProduct(),\n      step:    parseInt(route.query.step, 10) || 1,\n\n      useRandom:   true,\n      haveCurrent: !!current,\n      username:    me?.loginName || 'admin',\n      isFirstLogin,\n      mustChangePassword,\n      current,\n      password:    randomStr(),\n      confirm:     '',\n\n      v3User,\n\n      serverUrl,\n      mcmEnabled,\n\n      telemetry,\n\n      eula: false,\n      principals,\n\n      errors: []\n    };\n  },\n\n  computed: {\n    saveEnabled() {\n      if ( !this.eula && this.isFirstLogin) {\n        return false;\n      }\n\n      if ( this.mustChangePassword ) {\n        if ( !this.current ) {\n          return false;\n        }\n\n        if ( !this.useRandom ) {\n          if ( !this.password || this.password !== this.confirm ) {\n            return false;\n          }\n        }\n      }\n\n      return true;\n    },\n\n    me() {\n      const out = findBy(this.principals, 'me', true);\n\n      return out;\n    }\n  },\n\n  watch: {\n    useRandom(neu) {\n      if (neu) {\n        this.password = randomStr();\n      } else {\n        this.password = '';\n        this.$nextTick(() => {\n          this.$refs.password.focus();\n        });\n      }\n    }\n  },\n\n  methods: {\n    async save(buttonCb) {\n      const promises = [];\n\n      try {\n        await applyProducts(this.$store, this.$plugin);\n        await this.$store.dispatch('loadManagement');\n\n        if ( this.mustChangePassword ) {\n          await this.$store.dispatch('rancher/request', {\n            url:    '/v3/users?action=changepassword',\n            method: 'post',\n            data:   {\n              currentPassword: this.current,\n              newPassword:     this.password\n            },\n          });\n        } else {\n          promises.push(setSetting(this.$store, SETTING.FIRST_LOGIN, 'false'));\n        }\n\n        const user = this.v3User;\n\n        user.mustChangePassword = false;\n        this.$store.dispatch('auth/gotUser', user);\n\n        if (this.isFirstLogin) {\n          promises.push( setSetting(this.$store, SETTING.EULA_AGREED, (new Date()).toISOString()) );\n          promises.push( setSetting(this.$store, SETTING.TELEMETRY, this.telemetry ? 'in' : 'out') );\n\n          if ( this.mcmEnabled && this.serverUrl ) {\n            promises.push( setSetting(this.$store, SETTING.SERVER_URL, this.serverUrl) );\n          }\n        }\n\n        await Promise.all(promises);\n\n        setTimeout(() => {\n          buttonCb(true);\n          this.done();\n        }, 2000);\n      } catch (err) {\n        console.error(err) ; // eslint-disable-line no-console\n        buttonCb(false);\n        this.errors = exceptionToErrorsArray(err);\n      }\n    },\n\n    done() {\n      this.$router.replace('/');\n    },\n  },\n};\n</script>\n\n<template>\n  <form class=\"setup\">\n    <div class=\"row\">\n      <div class=\"col span-6 form-col\">\n        <div>\n          &nbsp;\n        </div>\n        <div>\n          <h1 class=\"text-center\">\n            {{ t('setup.welcome', {product}) }}\n          </h1>\n\n          <template v-if=\"mustChangePassword\">\n            <p\n              class=\"text-center mb-20 mt-20 setup-title\"\n              v-html=\"t(isFirstLogin ? 'setup.setPassword' : 'setup.newUserSetPassword', { username }, true)\"\n            />\n\n            <Password\n              v-if=\"!haveCurrent\"\n              v-model.trim=\"current\"\n              autocomplete=\"current-password\"\n              type=\"password\"\n              :label=\"t('setup.currentPassword')\"\n              class=\"mb-20\"\n              :required=\"true\"\n            />\n\n            <!-- For password managers... -->\n            <input\n              type=\"hidden\"\n              name=\"username\"\n              autocomplete=\"username\"\n              :value=\"username\"\n            >\n            <div class=\"mb-20\">\n              <RadioGroup\n                v-model=\"useRandom\"\n                data-testid=\"setup-password-mode\"\n                name=\"password-mode\"\n                :options=\"passwordOptions\"\n              />\n            </div>\n            <div class=\"mb-20\">\n              <LabeledInput\n                v-if=\"useRandom\"\n                ref=\"password\"\n                v-model.trim=\"password\"\n                :type=\"useRandom ? 'text' : 'password'\"\n                :disabled=\"useRandom\"\n                data-testid=\"setup-password-random\"\n                label-key=\"setup.newPassword\"\n              >\n                <template\n                  v-if=\"useRandom\"\n                  #suffix\n                >\n                  <div\n                    class=\"addon\"\n                    style=\"padding: 0 0 0 12px;\"\n                  >\n                    <CopyToClipboard\n                      :text=\"password\"\n                      class=\"btn-sm\"\n                    />\n                  </div>\n                </template>\n              </LabeledInput>\n              <Password\n                v-else\n                ref=\"password\"\n                v-model.trim=\"password\"\n                :label=\"t('setup.newPassword')\"\n                data-testid=\"setup-password\"\n                :required=\"true\"\n              />\n            </div>\n            <Password\n              v-show=\"!useRandom\"\n              v-model.trim=\"confirm\"\n              autocomplete=\"new-password\"\n              data-testid=\"setup-password-confirm\"\n              :label=\"t('setup.confirmPassword')\"\n              :required=\"true\"\n            />\n          </template>\n\n          <template v-if=\"isFirstLogin\">\n            <template v-if=\"mcmEnabled\">\n              <hr\n                v-if=\"mustChangePassword\"\n                class=\"mt-20 mb-20\"\n              >\n              <p>\n                <t\n                  k=\"setup.serverUrl.tip\"\n                  :raw=\"true\"\n                />\n              </p>\n              <div class=\"mt-20\">\n                <LabeledInput\n                  v-model=\"serverUrl\"\n                  :label=\"t('setup.serverUrl.label')\"\n                  data-testid=\"setup-server-url\"\n                />\n              </div>\n            </template>\n\n            <div class=\"checkbox mt-40\">\n              <Checkbox\n                id=\"checkbox-telemetry\"\n                v-model=\"telemetry\"\n              >\n                <template #label>\n                  <t\n                    k=\"setup.telemetry\"\n                    :raw=\"true\"\n                    :name=\"productName\"\n                  />\n                </template>\n              </Checkbox>\n            </div>\n            <div class=\"checkbox pt-10 eula\">\n              <Checkbox\n                id=\"checkbox-eula\"\n                v-model=\"eula\"\n                data-testid=\"setup-agreement\"\n              >\n                <template #label>\n                  <t\n                    k=\"setup.eula\"\n                    :raw=\"true\"\n                    :name=\"productName\"\n                  />\n                </template>\n              </Checkbox>\n            </div>\n          </template>\n\n          <div\n            id=\"submit\"\n            class=\"text-center mt-20\"\n          >\n            <AsyncButton\n              key=\"passwordSubmit\"\n              type=\"submit\"\n              mode=\"continue\"\n              :disabled=\"!saveEnabled\"\n              data-testid=\"setup-submit\"\n              @click=\"save\"\n            />\n          </div>\n\n          <div class=\"setup-errors mt-20\">\n            <h4\n              v-for=\"err in errors\"\n              :key=\"err\"\n              class=\"text-error text-center\"\n            >\n              {{ err }}\n            </h4>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"col span-6 landscape\" />\n    </div>\n  </form>\n</template>\n\n<style lang=\"scss\" scoped>\n  .principal {\n    display: block;\n    background: var(--box-bg);\n    border: 1px solid var(--border);\n    border-radius: 3px;\n    margin: 10px 0;\n    padding: 10px;\n    line-height: 40px;\n\n    img {\n      vertical-align: middle;\n      margin: 0 10px;\n    }\n  }\n\n  .setup {\n    overflow: hidden;\n\n    .row {\n      & .checkbox {\n        margin: auto\n      }\n\n      .span-6 {\n        padding: 0 60px;\n      }\n    }\n\n    .form-col {\n      display: flex;\n      flex-direction: column;\n      & > div:first-of-type {\n        flex:3;\n      }\n      & > div:nth-of-type(2) {\n        flex: 9;\n      }\n    }\n\n    .setup-title {\n      ::v-deep code {\n        font-size: 12px;\n        padding: 0;\n      }\n    }\n\n    .setup-errors {\n      min-height: 50px;\n    }\n\n    p {\n      line-height: 20px;\n    }\n\n  }\n\n  .landscape {\n    background-image: url('~@shell/assets/images/pl/login-landscape.svg');\n    background-repeat: no-repeat;\n    background-size: cover;\n    background-position: center center;\n    height: 100vh;\n  }\n</style>\n"],"sourceRoot":""}