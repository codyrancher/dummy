(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/c/_cluster/uiplugins/InstallDialog"],{"28f0":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("modal",{attrs:{name:"installPluginDialog",height:"auto",scrollable:!0}},[e.plugin?n("div",{staticClass:"plugin-install-dialog"},[n("h4",{staticClass:"mt-10"},[e._v(" "+e._s(e.t("plugins."+e.mode+".title",{name:e.plugin.label}))+" ")]),n("div",{staticClass:"custom mt-10"},[n("div",{staticClass:"dialog-panel"},[n("p",[e._v(" "+e._s(e.t("plugins."+e.mode+".prompt"))+" ")]),e.plugin.certified?e._e():n("Banner",{attrs:{color:"warning",label:e.t("plugins.install.warnNotCertified")}}),e.showVersionSelector?n("LabeledSelect",{staticClass:"version-selector mt-10",attrs:{"label-key":"plugins.install.version",options:e.versionOptions,"data-testid":"install-ext-modal-select-version"},model:{value:e.version,callback:function(t){e.version=t},expression:"version"}}):n("div",[e._v(" "+e._s(e.t("plugins.install.version"))+" "+e._s(e.version)+" ")])],1),n("div",{staticClass:"dialog-buttons"},[n("button",{staticClass:"btn role-secondary",attrs:{disabled:e.busy,"data-testid":"install-ext-modal-cancel-btn"},on:{click:function(t){return e.closeDialog(!1)}}},[e._v(" "+e._s(e.t("generic.cancel"))+" ")]),n("AsyncButton",{attrs:{mode:e.buttonMode,"data-testid":"install-ext-modal-install-btn"},on:{click:e.install}})],1)])]):e._e()])},i=[],s=n("ade3"),r=n("1da1"),l=(n("cf99"),n("8be0"),n("bb4d"),n("9d9d"),n("0b7a"),n("a797"),n("5986"),n("b0b4"),n("2b77"),n("a34a")),o=n.n(l),c=(n("96cf"),n("67c9")),u=n("a95f"),d=n("a788"),v=n("7388"),p=n("7600"),g=n("01ba"),h={components:{AsyncButton:c["b"],Banner:g["a"],LabeledSelect:u["a"]},fetch:function(){var e=this;return Object(r["a"])(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("management/find",{type:d["x"].SETTING,id:"system-default-registry"});case 2:e.defaultRegistrySetting=t.sent;case 3:case"end":return t.stop()}}),t)})))()},data:function(){return{currentVersion:"",defaultRegistrySetting:null,plugin:void 0,busy:!1,version:"",update:!1,mode:""}},computed:{showVersionSelector:function(){var e;return(null===(e=this.versionOptions)||void 0===e?void 0:e.length)>1},versionOptions:function(){var e,t,n=this;if(!this.plugin)return[];var a=null===(e=this.plugin)||void 0===e||null===(t=e.installableVersions)||void 0===t?void 0:t.filter((function(e){return!n.currentVersion||e.version!==n.currentVersion}));return a.map((function(e){return{label:e.version,value:e.version}}))},buttonMode:function(){return this.update?"update":"install"}},methods:{showDialog:function(e,t){var n,a,i,s,r=this;if(this.plugin=e,this.mode=t,this.version=e.displayVersion,"update"===t)this.currentVersion=e.displayVersion,(null===(a=e.installableVersions)||void 0===a?void 0:a.length)>0&&(this.version=null===(i=e.installableVersions)||void 0===i||null===(s=i[0])||void 0===s?void 0:s.version);else if("rollback"===t){var l=e.installableVersions.filter((function(t){return t.version!==e.displayVersion}));this.currentVersion=e.displayVersion,l.length>0&&(this.version=l[0].version)}var o,c,u=null===(n=e.installableVersions)||void 0===n?void 0:n.find((function(e){return e.version===r.version}));u||(this.version=null===(o=e.installableVersions)||void 0===o||null===(c=o[0])||void 0===c?void 0:c.version);this.busy=!1,this.update="install"!==t,this.$modal.show("installPluginDialog")},closeDialog:function(e){this.$modal.hide("installPluginDialog"),this.$emit("closed",e)},install:function(){var e=this;return Object(r["a"])(o.a.mark((function t(){var n,a,i,r,l,c,u,g,h,b,m,f,y,w,N,x,V,_,O,k,$;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.busy=!0,r=e.plugin,e.$emit("update",r.name,"install"),l=null===(n=r.versions)||void 0===n?void 0:n.find((function(t){return t.version===e.version})),l){t.next=7;break}return e.busy=!1,t.abrupt("return");case 7:return c=!1,t.prev=8,t.next=11,e.$store.dispatch("catalog/getVersionInfo",{repoType:l.repoType,repoName:l.repoName,chartName:r.chart.chartName,versionName:e.version});case 11:h=t.sent,b=(null===h||void 0===h||null===(u=h.values)||void 0===u||null===(g=u.image)||void 0===g?void 0:g.repository)||"",c=b.startsWith("rancher/"),t.next=18;break;case 16:t.prev=16,t.t0=t["catch"](8);case 18:return m=!1,t.prev=19,t.next=22,e.$store.dispatch("management/find",{type:d["f"].APP,id:"".concat(p["g"],"/").concat(r.chart.chartName),opt:{force:!0}});case 22:f=t.sent,m=!!f,t.next=28;break;case 26:t.prev=26,t.t1=t["catch"](19);case 28:return y=l.repoType,w=l.repoName,N=e.$store.getters["catalog/repo"]({repoType:y,repoName:w}),x={chartName:r.chart.chartName,version:e.version,releaseName:r.chart.chartName,annotations:(a={},Object(s["a"])(a,v["e"].SOURCE_REPO_TYPE,r.repoType),Object(s["a"])(a,v["e"].SOURCE_REPO_NAME,r.repoName),a),values:{}},V=(null===(i=e.defaultRegistrySetting)||void 0===i?void 0:i.value)||"",c&&V&&(x.values.global=x.values.global||{},x.values.global.cattle=x.values.global.cattle||{},x.values.global.cattle.systemDefaultRegistry=V),_={charts:[x],namespace:p["g"]},O=m||e.update?"upgrade":"install",t.prev=36,t.next=39,N.doAction(O,_);case 39:return k=t.sent,$="".concat(k.operationNamespace,"/").concat(k.operationName),e.closeDialog(r),t.next=44,N.waitForOperation($);case 44:return t.next=46,e.$store.dispatch("management/find",{type:d["f"].OPERATION,id:$});case 46:t.next=52;break;case 48:t.prev=48,t.t2=t["catch"](36),e.$store.dispatch("growl/error",{title:e.t("plugins.error.generic"),message:t.t2.message?t.t2.message:t.t2,timeout:1e4},{root:!0}),e.closeDialog(r);case 52:case"end":return t.stop()}}),t,null,[[8,16],[19,26],[36,48]])})))()}}},b=h,m=(n("dd38"),n("0c7c")),f=Object(m["a"])(b,a,i,!1,null,"0c3745a3",null);t["default"]=f.exports},"3bb8":function(e,t,n){},dd38:function(e,t,n){"use strict";n("3bb8")}}]);
//# sourceMappingURL=InstallDialog.735718c2.js.map