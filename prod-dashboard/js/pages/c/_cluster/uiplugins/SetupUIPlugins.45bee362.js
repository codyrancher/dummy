(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/c/_cluster/uiplugins/SetupUIPlugins"],{"10ef":function(e,t,a){},"24c6":function(e,t,a){},"45ca":function(e,t,a){"use strict";a("10ef")},c150:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("IconMessage",{attrs:{vertical:!0,subtle:!1,icon:"icon-gear"},scopedSlots:e._u([{key:"message",fn:function(){return[a("h2",[e._v(" "+e._s(e.t("plugins.setup.title"))+" ")]),e.loading?e._e():a("div",[e.haveCharts?a("div",[a("p",[e._v(" "+e._s(e.t("plugins.setup.prompt.can"))+" ")]),a("AsyncButton",{staticClass:"enable-plugin-support",attrs:{mode:"enable",manual:!0,"current-phase":e.buttonState,"data-testid":"extension-enable-operator"},on:{click:e.enable}})],1):a("div",[a("p",[e._v(" "+e._s(e.t("plugins.setup.prompt.cant"))+" ")])]),e._l(e.errors,(function(t,n){return a("div",{key:n,staticClass:"plugin-setup-error"},[e._v(" "+e._s(t)+" ")])}))],2)]},proxy:!0}])}),a("Dialog",{attrs:{name:"confirm-uiplugins-setup",title:e.t("plugins.setup.install.title")},on:{closed:e.dialogClosed}},[[a("p",[e._v(" "+e._s(e.t("plugins.setup.install.prompt"))+" ")]),e.hasRancherUIPluginsRepo?e._e():a("div",{staticClass:"mt-20"},[a("Checkbox",{attrs:{primary:!0,"label-key":"plugins.setup.install.addRancherRepo"},model:{value:e.addRepo,callback:function(t){e.addRepo=t},expression:"addRepo"}}),a("div",{staticClass:"checkbox-info"},[e._v(" "+e._s(e.t("plugins.setup.install.airgap"))+" ")])],1)]],2)],1)},s=[],r=a("ade3"),o=a("1da1"),i=a("a34a"),c=a.n(i),l=(a("96cf"),a("4d7f"),a("8be0"),a("38aa"),a("9d9d"),a("0b7a"),a("a797"),a("5986"),a("2b77"),a("e673"),a("67c9")),u=a("2678"),p=a("a788"),d=a("7388"),h=a("e5e4"),f=a("bd30"),g=a("7600"),m={components:{AsyncButton:l["b"],Checkbox:f["a"],IconMessage:u["a"],Dialog:h["a"]},fetch:function(){var e=this;return Object(o["a"])(c.a.mark((function t(){var a,n,s;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$store.getters["catalog/rawCharts"],n=Object.values(a),s=[],g["e"].forEach((function(e){var t=n.find((function(t){return t.repoName===g["i"]&t.chartName===e}));t&&s.push(t)})),e.haveCharts=s.length===g["e"].length,!e.haveCharts){t.next=10;break}if(e.installCharts=s,!e.$store.getters["management/schemaFor"](p["f"].CLUSTER_REPO)){t.next=10;break}return t.next=10,e.$store.dispatch("management/findAll",{type:p["f"].CLUSTER_REPO});case 10:return t.next=12,e.$store.dispatch("management/find",{type:p["x"].SETTING,id:"system-default-registry"});case 12:e.defaultRegistrySetting=t.sent,e.loading=!1;case 14:case"end":return t.stop()}}),t)})))()},data:function(){return{loading:!0,haveCharts:!1,installCharts:[],errors:[],addRepo:!0,buttonState:l["a"].ACTION,defaultRegistrySetting:null}},computed:{hasRancherUIPluginsRepo:function(){var e=this.$store.getters["catalog/repos"];return!!e.find((function(e){return e.name===g["b"]}))}},methods:{installChart:function(e){var t=this;return Object(o["a"])(c.a.mark((function a(){var n,s,o,i,l,u,h,f,m,v,b,_;return c.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=e.versions[0],i=o.repoType,l=o.repoName,u=t.$store.getters["catalog/repo"]({repoType:i,repoName:l}),h={chartName:e.chartName,version:o.version,releaseName:e.chartName,annotations:(n={},Object(r["a"])(n,d["e"].SOURCE_REPO_TYPE,i),Object(r["a"])(n,d["e"].SOURCE_REPO_NAME,l),n),values:{}},f=(null===(s=t.defaultRegistrySetting)||void 0===s?void 0:s.value)||"",f&&(h.values.global=h.values.global||{},h.values.global.cattle=h.values.global.cattle||{},h.values.global.cattle.systemDefaultRegistry=f),m={charts:[h],wait:!0,namespace:g["g"]},v="install",a.next=11,u.doAction(v,m);case 11:return b=a.sent,_="".concat(b.operationNamespace,"/").concat(b.operationName),a.next=15,u.waitForOperation(_);case 15:return a.abrupt("return",t.$store.dispatch("management/find",{type:p["f"].OPERATION,id:_}));case 16:case"end":return a.stop()}}),a)})))()},enable:function(){this.errors=[],this.addRepo=!this.hasRancherUIPluginsRepo,this.$modal.show("confirm-uiplugins-setup")},dialogClosed:function(e){var t=this;return Object(o["a"])(c.a.mark((function a(){return c.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.errors=[],!e){a.next=12;break}if(t.buttonState=l["a"].WAITING,!t.addRepo){a.next=6;break}return a.next=6,t.addDefaultHelmRepository();case 6:return a.next=8,t.installPluginCharts();case 8:return a.next=10,new Promise((function(e){return setTimeout(e,5e3)}));case 10:t.buttonState=t.errors.length>0?l["a"].ERROR:l["a"].ACTION,t.$emit("done");case 12:case"end":return a.stop()}}),a)})))()},addDefaultHelmRepository:function(){var e=this;return Object(o["a"])(c.a.mark((function t(){var a,n;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=g["b"],t.prev=1,t.next=4,e.$store.dispatch("management/create",{type:p["f"].CLUSTER_REPO,metadata:{name:a},spec:{gitBranch:g["a"],gitRepo:g["c"]}});case 4:return n=t.sent,t.abrupt("return",n.save());case 8:t.prev=8,t.t0=t["catch"](1),console.error(t.t0),e.errors.push(t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()},installPluginCharts:function(){var e=this;return Object(o["a"])(c.a.mark((function t(){var a,n;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.installCharts.length)){t.next=14;break}return n=e.installCharts[a],t.prev=3,t.next=6,e.installChart(n);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](3),e.errors.push(t.t0.message);case 11:a++,t.next=1;break;case 14:return t.abrupt("return",new Promise((function(e){return setTimeout(e,2e3)})));case 15:case"end":return t.stop()}}),t,null,[[3,8]])})))()}}},v=m,b=(a("f413"),a("0c7c")),_=Object(b["a"])(v,n,s,!1,null,"320baac8",null);t["default"]=_.exports},e5e4:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("modal",{attrs:{name:e.name,height:"auto",scrollable:!0},on:{closed:function(t){return e.closeDialog(!1)},"before-open":e.beforeOpen}},[a("div",{staticClass:"modal-dialog"},[a("h4",[e._v(" "+e._s(e.title)+" ")]),e._t("default"),a("div",{staticClass:"dialog-buttons mt-20"},[e._t("buttons"),e.$slots.buttons?e._e():a("div",[a("button",{staticClass:"btn role-secondary",on:{click:function(t){return e.closeDialog(!1)}}},[e._v(" "+e._s(e.t("generic.cancel"))+" ")]),e.mode?a("AsyncButton",{staticClass:"ml-10",attrs:{mode:e.mode},on:{click:e.ok}}):a("button",{staticClass:"btn role-primary ml-10",on:{click:function(t){return e.closeDialog(!0)}}},[e._v(" "+e._s(e.t("generic.ok"))+" ")])],1)],2)],2)])},s=[],r=(a("0b7a"),a("67c9")),o={components:{AsyncButton:r["b"]},props:{name:{type:String,required:!0},title:{type:String,required:!0},mode:{type:String,default:""}},data:function(){return{closed:!1}},methods:{beforeOpen:function(){this.closed=!1},ok:function(e){var t=this,a=function(a){e(a),a&&t.closeDialog(!0)};this.$emit("okay",a)},closeDialog:function(e){this.closed||(this.$modal.hide(this.name),this.$emit("closed",e),this.closed=!0)}}},i=o,c=(a("45ca"),a("0c7c")),l=Object(c["a"])(i,n,s,!1,null,"5130a572",null);t["a"]=l.exports},f413:function(e,t,a){"use strict";a("24c6")}}]);
//# sourceMappingURL=SetupUIPlugins.45bee362.js.map