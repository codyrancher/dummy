{"version":3,"sources":["webpack:///./shell/pages/c/_cluster/uiplugins/RemoveUIPlugins.vue?b3cf","webpack:///shell/pages/c/_cluster/uiplugins/RemoveUIPlugins.vue","webpack:///./shell/pages/c/_cluster/uiplugins/RemoveUIPlugins.vue?c9dc","webpack:///./shell/pages/c/_cluster/uiplugins/RemoveUIPlugins.vue","webpack:///./shell/components/Dialog.vue?0a1a","webpack:///./shell/pages/c/_cluster/uiplugins/RemoveUIPlugins.vue?dbfd","webpack:///./shell/components/Dialog.vue?4be5","webpack:///shell/components/Dialog.vue","webpack:///./shell/components/Dialog.vue?0d6a","webpack:///./shell/components/Dialog.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","t","on","doRemove","_v","_s","defaultRepo","staticClass","model","value","callback","$$v","removeRepo","expression","_e","removeCRD","staticRenderFns","components","Checkbox","Dialog","fetch","type","opt","force","repos","plugins","data","errors","hasPluginsInstalled","methods","removeChart","name","apps","found","Promise","showDialog","btnCb","uninstall","i","chart","component","$event","closeDialog","beforeOpen","title","_t","$slots","buttons","mode","ok","AsyncButton","props","required","default","closed","result"],"mappings":"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","file":"js/pages/c/_cluster/uiplugins/RemoveUIPlugins.0e1c145d.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Dialog',{attrs:{\"name\":\"confirm-uiplugins-remove\",\"title\":_vm.t('plugins.setup.remove.title'),\"mode\":\"disable\",\"data-testid\":\"disable-ext-modal\"},on:{\"okay\":_vm.doRemove}},[[_c('p',[_vm._v(\" \"+_vm._s(_vm.t('plugins.setup.remove.prompt'))+\" \")]),(!!_vm.defaultRepo)?_c('div',{staticClass:\"mt-20\"},[_c('Checkbox',{attrs:{\"primary\":true,\"label-key\":\"plugins.setup.remove.registry.title\",\"data-testid\":\"disable-ext-modal-remove-repo\"},model:{value:(_vm.removeRepo),callback:function ($$v) {_vm.removeRepo=$$v},expression:\"removeRepo\"}}),_c('div',{staticClass:\"checkbox-info\"},[_vm._v(\" \"+_vm._s(_vm.t('plugins.setup.remove.registry.prompt'))+\" \")])],1):_vm._e(),(_vm.hasPluginsInstalled)?_c('div',{staticClass:\"mt-20\"},[_c('Checkbox',{attrs:{\"primary\":true,\"label-key\":\"plugins.setup.remove.crd.title\"},model:{value:(_vm.removeCRD),callback:function ($$v) {_vm.removeCRD=$$v},expression:\"removeCRD\"}}),_c('div',{staticClass:\"checkbox-info\"},[_vm._v(\" \"+_vm._s(_vm.t('plugins.setup.remove.crd.prompt'))+\" \")])],1):_vm._e()]],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nimport { CATALOG, UI_PLUGIN } from '@shell/config/types';\nimport Dialog from '@shell/components/Dialog.vue';\nimport Checkbox from '@components/Form/Checkbox/Checkbox.vue';\nimport {\n  UI_PLUGIN_NAMESPACE,\n  UI_PLUGIN_CHARTS,\n  UI_PLUGINS_REPO_NAME,\n  UI_PLUGINS_REPO_URL,\n  UI_PLUGIN_OPERATOR_CRD_CHART_NAME,\n} from '@shell/config/uiplugins';\n\nexport default {\n  components: {\n    Checkbox,\n    Dialog,\n  },\n\n  async fetch() {\n    if (this.$store.getters['management/schemaFor'](CATALOG.CLUSTER_REPO)) {\n      const repos = await this.$store.dispatch('management/findAll', { type: CATALOG.CLUSTER_REPO, opt: { force: true } });\n\n      this.defaultRepo = repos.find(r => r.name === UI_PLUGINS_REPO_NAME && r.spec.gitRepo === UI_PLUGINS_REPO_URL);\n    }\n\n    if (this.$store.getters['management/schemaFor'](UI_PLUGIN)) {\n      const plugins = await this.$store.dispatch('management/findAll', { type: UI_PLUGIN });\n\n      // Are there any plugins installed?\n      this.hasPluginsInstalled = (plugins || []).length > 0;\n      this.removeCRD = !this.hasPluginsInstalled;\n    }\n  },\n\n  data() {\n    return {\n      errors:              [],\n      defaultRepo:         undefined,\n      removeRepo:          false,\n      removeCRD:           true,\n      hasPluginsInstalled: false,\n    };\n  },\n\n  methods: {\n    async removeChart(name) {\n      const apps = await this.$store.dispatch('management/findAll', { type: CATALOG.APP });\n      const found = apps.find((app) => {\n        return app.namespace === UI_PLUGIN_NAMESPACE && app.name === name;\n      });\n\n      if (found) {\n        return found.remove();\n      }\n\n      // Return rejected promise - could not find the required chart\n      return Promise.reject(new Error(`Could not find chart ยง{ name }`));\n    },\n\n    showDialog() {\n      this.removeRepo = !!this.defaultRepo;\n      this.$modal.show('confirm-uiplugins-remove');\n    },\n\n    async doRemove(btnCb) {\n      this.errors = [];\n\n      // Remove the charts in the reverse order that we install them in\n      let uninstall = [...UI_PLUGIN_CHARTS].reverse();\n\n      if (!this.removeCRD) {\n        // User does not want to uninstall the CRD, so remove the chart\n        uninstall = uninstall.filter(chart => chart !== UI_PLUGIN_OPERATOR_CRD_CHART_NAME);\n      }\n\n      for (let i = 0; i < uninstall.length; i++) {\n        const chart = uninstall[i];\n\n        try {\n          await this.removeChart(chart);\n        } catch (e) {\n          this.errors.push(e.message);\n        }\n      }\n\n      if (this.removeRepo && this.defaultRepo) {\n        try {\n          await this.defaultRepo.remove();\n        } catch (e) {\n          this.errors.push(e.message);\n        }\n      }\n\n      this.$store.dispatch('management/forgetType', UI_PLUGIN);\n\n      await new Promise(resolve => setTimeout(resolve, 5000));\n\n      this.$emit('done');\n\n      btnCb(true);\n    },\n  }\n};\n</script>\n<template>\n  <Dialog\n    name=\"confirm-uiplugins-remove\"\n    :title=\"t('plugins.setup.remove.title')\"\n    mode=\"disable\"\n    data-testid=\"disable-ext-modal\"\n    @okay=\"doRemove\"\n  >\n    <template>\n      <p>\n        {{ t('plugins.setup.remove.prompt') }}\n      </p>\n      <div\n        v-if=\"!!defaultRepo\"\n        class=\"mt-20\"\n      >\n        <Checkbox\n          v-model=\"removeRepo\"\n          :primary=\"true\"\n          label-key=\"plugins.setup.remove.registry.title\"\n          data-testid=\"disable-ext-modal-remove-repo\"\n        />\n        <div class=\"checkbox-info\">\n          {{ t('plugins.setup.remove.registry.prompt') }}\n        </div>\n      </div>\n      <div\n        v-if=\"hasPluginsInstalled\"\n        class=\"mt-20\"\n      >\n        <Checkbox\n          v-model=\"removeCRD\"\n          :primary=\"true\"\n          label-key=\"plugins.setup.remove.crd.title\"\n        />\n        <div class=\"checkbox-info\">\n          {{ t('plugins.setup.remove.crd.prompt') }}\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n<style lang=\"scss\" scoped>\n  .enable-plugin-support {\n    font-size: 14px;\n    margin-top: 20px;\n  }\n\n  .plugin-setup-error {\n    font-size: 14px;\n    color: var(--error);\n    margin: 10px 0 0 0;\n  }\n\n  .checkbox-info {\n    margin-left: 20px;\n    opacity: 0.7;\n  }\n</style>\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../../../../node_modules/babel-loader/lib/index.js??ref--16-1!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoveUIPlugins.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../../../../node_modules/babel-loader/lib/index.js??ref--16-1!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoveUIPlugins.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RemoveUIPlugins.vue?vue&type=template&id=e4a36550&scoped=true&\"\nimport script from \"./RemoveUIPlugins.vue?vue&type=script&lang=js&\"\nexport * from \"./RemoveUIPlugins.vue?vue&type=script&lang=js&\"\nimport style0 from \"./RemoveUIPlugins.vue?vue&type=style&index=0&id=e4a36550&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"e4a36550\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./Dialog.vue?vue&type=style&index=0&id=5130a572&prod&lang=scss&scoped=true&\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./RemoveUIPlugins.vue?vue&type=style&index=0&id=e4a36550&prod&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('modal',{attrs:{\"name\":_vm.name,\"height\":\"auto\",\"scrollable\":true},on:{\"closed\":function($event){return _vm.closeDialog(false)},\"before-open\":_vm.beforeOpen}},[_c('div',{staticClass:\"modal-dialog\"},[_c('h4',[_vm._v(\" \"+_vm._s(_vm.title)+\" \")]),_vm._t(\"default\"),_c('div',{staticClass:\"dialog-buttons mt-20\"},[_vm._t(\"buttons\"),(!_vm.$slots.buttons)?_c('div',[_c('button',{staticClass:\"btn role-secondary\",on:{\"click\":function($event){return _vm.closeDialog(false)}}},[_vm._v(\" \"+_vm._s(_vm.t('generic.cancel'))+\" \")]),(!_vm.mode)?_c('button',{staticClass:\"btn role-primary ml-10\",on:{\"click\":function($event){return _vm.closeDialog(true)}}},[_vm._v(\" \"+_vm._s(_vm.t('generic.ok'))+\" \")]):_c('AsyncButton',{staticClass:\"ml-10\",attrs:{\"mode\":_vm.mode},on:{\"click\":_vm.ok}})],1):_vm._e()],2)],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nimport AsyncButton from '@shell/components/AsyncButton';\n\nexport default {\n  components: { AsyncButton },\n\n  props: {\n    name: {\n      type:     String,\n      required: true,\n    },\n\n    title: {\n      type:     String,\n      required: true,\n    },\n\n    mode: {\n      type:    String,\n      default: '',\n    }\n  },\n\n  data() {\n    return { closed: false };\n  },\n\n  methods: {\n    beforeOpen() {\n      this.closed = false;\n    },\n\n    ok(btnCb) {\n      const callback = (ok) => {\n        btnCb(ok);\n        if (ok) {\n          this.closeDialog(true);\n        }\n      };\n\n      this.$emit('okay', callback);\n    },\n\n    closeDialog(result) {\n      if (!this.closed) {\n        this.$modal.hide(this.name);\n        this.$emit('closed', result);\n        this.closed = true;\n      }\n    },\n  }\n};\n</script>\n\n<template>\n  <modal\n    :name=\"name\"\n    height=\"auto\"\n    :scrollable=\"true\"\n    @closed=\"closeDialog(false)\"\n    @before-open=\"beforeOpen\"\n  >\n    <div class=\"modal-dialog\">\n      <h4>\n        {{ title }}\n      </h4>\n      <slot />\n      <div class=\"dialog-buttons mt-20\">\n        <slot name=\"buttons\" />\n        <div v-if=\"!$slots.buttons\">\n          <button\n            class=\"btn role-secondary\"\n            @click=\"closeDialog(false)\"\n          >\n            {{ t('generic.cancel') }}\n          </button>\n          <button\n            v-if=\"!mode\"\n            class=\"btn role-primary ml-10\"\n            @click=\"closeDialog(true)\"\n          >\n            {{ t('generic.ok') }}\n          </button>\n          <AsyncButton\n            v-else\n            :mode=\"mode\"\n            class=\"ml-10\"\n            @click=\"ok\"\n          />\n        </div>\n      </div>\n    </div>\n  </modal>\n</template>\n\n<style lang=\"scss\" scoped>\n  .modal-dialog {\n    padding: 10px;\n\n    h4 {\n      font-weight: bold;\n    }\n\n    .dialog-buttons {\n      display: flex;\n      justify-content: flex-end;\n      margin-top: 10px;\n\n      > *:not(:last-child) {\n        margin-right: 10px;\n      }\n    }\n  }\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../node_modules/babel-loader/lib/index.js??ref--16-1!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./Dialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--16-0!../../node_modules/babel-loader/lib/index.js??ref--16-1!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!./Dialog.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Dialog.vue?vue&type=template&id=5130a572&scoped=true&\"\nimport script from \"./Dialog.vue?vue&type=script&lang=js&\"\nexport * from \"./Dialog.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Dialog.vue?vue&type=style&index=0&id=5130a572&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5130a572\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}