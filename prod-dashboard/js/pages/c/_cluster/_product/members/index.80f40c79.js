(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/c/_cluster/_product/members/index"],{"2e36":function(e,t,r){},"8b11":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ExplorerMembers",e._b({},"ExplorerMembers",e.$attrs,!1))},a=[],o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"project-members"},[r("Masthead",{attrs:{schema:e.schema,resource:e.resource,"favorite-resource":e.VIRTUAL_TYPES.CLUSTER_MEMBERS,"create-location":e.createLocation,"create-button-label":e.t("members.createActionLabel"),"is-creatable":!1,"type-display":e.t("members.clusterAndProject")}}),e.isLocal?r("Banner",{attrs:{color:"error",label:e.t("members.localClusterWarning")}}):e._e(),r("Tabbed",[r("Tab",{attrs:{name:"cluster-membership",label:"Cluster Membership"}},[e.canEditClusterMembers?r("div",{staticClass:"row mb-10 cluster-add"},[r("n-link",{staticClass:"btn role-primary pull-right",attrs:{to:e.createLocation}},[e._v(" "+e._s(e.t("members.createActionLabel"))+" ")])],1):e._e(),r("ResourceTable",{attrs:{schema:e.schema,headers:e.headers,rows:e.filteredClusterRoleTemplateBindings,groupable:!1,namespaced:!1,loading:e.$fetchState.pending||!e.currentCluster||e.loadingClusterBindings,"sub-search":"subSearch","sub-fields":["nameDisplay"]}})],1),e.canManageProjectMembers?r("Tab",{attrs:{name:"project-membership",label:"Project Membership"}},[r("SortableTable",{attrs:{"group-by":"projectId",loading:e.$fetchState.pending||!e.currentCluster||e.loadingProjectBindings,rows:e.rowsWithFakeProjects,headers:e.projectRoleTemplateColumns},scopedSlots:e._u([{key:"group-by",fn:function(t){return[r("div",{staticClass:"group-bar"},[r("div",{directives:[{name:"trim-whitespace",rawName:"v-trim-whitespace"}],staticClass:"group-tab"},[r("div",{staticClass:"project-name",domProps:{innerHTML:e._s(e.getProjectLabel(t))}})]),r("div",{staticClass:"right"},[e.canEditProjectMembers?r("button",{staticClass:"create-namespace btn btn-sm role-secondary mr-5 right",attrs:{type:"button"},on:{click:function(r){return e.addProjectMember(t)}}},[e._v(" "+e._s(e.t("members.createActionLabel"))+" ")]):e._e()])])]}},e._l(e.projectsWithoutRoles,(function(t){return{key:e.slotName(t),fn:function(){return[r("tr",{key:t.id,staticClass:"main-row"},[r("td",{staticClass:"empty text-center",attrs:{colspan:"100%"}},[e._v(" "+e._s(e.t("members.noRolesAssigned"))+" ")])])]},proxy:!0}}))],null,!0)})],1):e._e()],1)],1)},s=[],c=(r("13ec"),r("7e5b"),r("38aa"),r("bcff"),r("2909")),i=r("ade3"),l=r("3835"),u=r("1da1"),d=r("a34a"),m=r.n(d),p=(r("96cf"),r("a797"),r("8be0"),r("e673"),r("a41c"),r("5986"),r("bb4d"),r("cf99"),r("b667"),r("ddc0"),r("9ce4"),r("6d55"),r("1d8f"),r("2b77"),r("9d9d"),r("a788")),b=r("b178"),f=r("39ce"),h=r("9149"),g=r("e012"),j=r("01ba"),T=r("a4d2"),P=r("f38f"),v=r("40d2"),E=r("2f62"),R=r("997a8"),C=r("fa98");function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O={name:"ExplorerMembers",components:{Banner:j["a"],Masthead:f["a"],ResourceTable:b["a"],Tabbed:T["a"],Tab:P["a"],SortableTable:v["c"]},props:{createLocationOverride:{type:Object,default:function(){return{name:"c-cluster-product-resource-create",params:{resource:p["x"].CLUSTER_ROLE_TEMPLATE_BINDING}}}}},fetch:function(){var e=this;return Object(u["a"])(m.a.mark((function t(){var r,n,a;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$store.getters["rancher/schemaFor"](p["D"].CLUSTER_ROLE_TEMPLATE_BINDING),n=e.$store.getters["rancher/schemaFor"](p["D"].PROJECT_ROLE_TEMPLATE_BINDING),e.$set(e,"normanClusterRTBSchema",r),e.$set(e,"normanProjectRTBSchema",n),r&&Promise.all([e.$store.dispatch("rancher/findAll",{type:p["D"].CLUSTER_ROLE_TEMPLATE_BINDING},{root:!0}),e.$store.dispatch("management/findAll",{type:p["x"].CLUSTER_ROLE_TEMPLATE_BINDING})]).then((function(t){var r=Object(l["a"])(t,1),n=r[0];e.$set(e,"normanClusterRoleTemplateBindings",n),e.loadingClusterBindings=!1})),n&&e.$store.dispatch("rancher/findAll",{type:p["D"].PROJECT_ROLE_TEMPLATE_BINDING},{root:!0}).then((function(t){e.$set(e,"projectRoleTemplateBindings",t),e.loadingProjectBindings=!1})),e.$store.dispatch("management/findAll",{type:p["x"].PROJECT}).then((function(t){return e.$set(e,"projects",t)})),a={normanPrincipals:e.$store.dispatch("rancher/findAll",{type:p["D"].PRINCIPAL}),mgmt:e.$store.dispatch("management/findAll",{type:p["x"].USER}),mgmtRoleTemplates:e.$store.dispatch("management/findAll",{type:p["x"].ROLE_TEMPLATE})},t.next=10,Object(C["a"])(a);case 10:case"end":return t.stop()}}),t)})))()},data:function(){return{schema:this.$store.getters["management/schemaFor"](p["x"].CLUSTER_ROLE_TEMPLATE_BINDING),headers:[h["wb"],h["hb"],h["qb"],h["b"]],createLocation:L(L({},this.createLocationOverride),{},{params:L(L({},this.createLocationOverride.params),{},{cluster:this.$store.getters["currentCluster"].id})}),resource:p["x"].CLUSTER_ROLE_TEMPLATE_BINDING,normanClusterRTBSchema:null,normanProjectRTBSchema:null,normanClusterRoleTemplateBindings:[],projectRoleTemplateBindings:[],projects:[],VIRTUAL_TYPES:p["Y"],projectRoleTemplateColumns:[h["wb"],{name:"member",labeKey:"generic.name",value:"principalId",formatter:"Principal"},{name:"role",labelKey:"tableHeaders.role",value:"roleTemplate.nameDisplay"},L(L({},h["b"]),{},{value:"createdTS"})],loadingProjectBindings:!0,loadingClusterBindings:!0}},computed:L(L({},Object(E["b"])(["currentCluster"])),{},{clusterRoleTemplateBindings:function(){return this.normanClusterRoleTemplateBindings.map((function(e){return e.clusterroletemplatebinding}))},filteredClusterRoleTemplateBindings:function(){var e=this;return this.clusterRoleTemplateBindings.filter((function(t){return(null===t||void 0===t?void 0:t.clusterName)===e.$store.getters["currentCluster"].id}))},filteredProjects:function(){var e=this;return this.projects.reduce((function(t,r){var n;return(null===r||void 0===r||null===(n=r.spec)||void 0===n?void 0:n.clusterName)===e.currentCluster.id&&(t[r.id]=r),t}),{})},filteredProjectRoleTemplateBindings:function(){var e=this,t=this.projectRoleTemplateBindings.filter((function(t){var r=t.projectId.replace(":","/");return!!e.filteredProjects[r]}));return t},projectsWithoutRoles:function(){var e=this,t=this.filteredProjectRoleTemplateBindings.reduce((function(e,t){var r=(t.projectId||"").replace(":","/");return e.includes(r)||e.push(r),e}),[]);return Object.keys(this.filteredProjects).reduce((function(r,n){var a=e.filteredProjects[n];return t.includes(n)||r.push(a),r}),[])},rowsWithFakeProjects:function(){var e=this.projectsWithoutRoles.map((function(e){var t;return{groupByLabel:"resourceTable.groupLabel.notInAProject".concat("-",e.id),isFake:!0,mainRowKey:e.id,nameDisplay:null===(t=e.spec)||void 0===t?void 0:t.displayName,project:e,availableActions:[],projectId:e.id}}));return[].concat(Object(c["a"])(e),Object(c["a"])(this.filteredProjectRoleTemplateBindings))},canManageMembers:function(){return Object(g["a"])(this.$store)},canManageProjectMembers:function(){return Object(R["a"])(this.$store)},isLocal:function(){return this.$store.getters["currentCluster"].isLocal},canEditProjectMembers:function(){var e;return null===(e=this.normanProjectRTBSchema)||void 0===e?void 0:e.collectionMethods.find((function(e){return"post"===e.toLowerCase()}))},canEditClusterMembers:function(){var e;return null===(e=this.normanClusterRTBSchema)||void 0===e?void 0:e.collectionMethods.find((function(e){return"post"===e.toLowerCase()}))}}),methods:{getMgmtProjectId:function(e){return e.group.key.replace(":","/")},getMgmtProject:function(e){return this.$store.getters["management/byId"](p["x"].PROJECT,this.getMgmtProjectId(e))},getProjectLabel:function(e){var t,r;return null===(t=this.getMgmtProject(e))||void 0===t||null===(r=t.spec)||void 0===r?void 0:r.displayName},addProjectMember:function(e){this.$store.dispatch("cluster/promptModal",{component:"AddProjectMemberDialog",componentProps:{projectId:e.group.key.replace("/",":"),saveInModal:!0},modalSticky:!0})},slotName:function(e){return"main-row:".concat(e.id)}}},y=O,M=(r("f9e3"),r("0c7c")),B=Object(M["a"])(y,o,s,!1,null,"4be73df3",null),I=B.exports,w={components:{ExplorerMembers:I}},A=w,S=Object(M["a"])(A,n,a,!1,null,null,null);t["default"]=S.exports},f9e3:function(e,t,r){"use strict";r("2e36")}}]);
//# sourceMappingURL=index.80f40c79.js.map