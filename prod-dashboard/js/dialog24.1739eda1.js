(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dialog24"],{2836:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("Card",{staticClass:"prompt-rollback",attrs:{"show-highlight-border":!1}},[o("h4",{staticClass:"text-default-text",attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.t("promptRollback.modalTitle",{workloadName:e.workloadName},!0))+" ")]),o("div",{staticClass:"pl-10 pr-10 ",attrs:{slot:"body"},slot:"body"},[1===e.revisions.length?o("Banner",{attrs:{color:"info",label:e.t("promptRollback.singleRevisionBanner")}}):e._e(),o("form",[o("LabeledSelect",{staticClass:"provider",attrs:{label:e.t("promptRollback.dropdownTitle"),placeholder:e.t("promptRollback.placeholder"),options:e.revisions,"get-option-label":e.getOptionLabel},model:{value:e.selectedRevision,callback:function(t){e.selectedRevision=t},expression:"selectedRevision"}})],1),e._l(e.errors,(function(e,t){return o("Banner",{key:t,attrs:{color:"error",label:e}})})),e.selectedRevision&&e.showDiff?o("YamlEditor",{key:e.selectedRevisionId,staticClass:"mt-10 ",attrs:{"initial-yaml-values":e.sanitizeYaml(e.currentRevision),"editor-mode":e.editorMode,"as-object":!0},model:{value:e.sanitizedSelectedRevision,callback:function(t){e.sanitizedSelectedRevision=t},expression:"sanitizedSelectedRevision"}}):e._e()],2),o("div",{staticClass:"buttons ",attrs:{slot:"actions"},slot:"actions"},[o("div",{staticClass:"left"},[o("button",{staticClass:"btn role-secondary diff",attrs:{disabled:!e.selectedRevision},on:{click:function(t){e.showDiff=!e.showDiff,e.sizeDialog()}}},[e._v(" "+e._s(e.showDiff?e.t("resourceYaml.buttons.hideDiff"):e.t("resourceYaml.buttons.diff"))+" ")])]),o("div",{staticClass:"right"},[o("button",{staticClass:"btn role-secondary mr-10",on:{click:e.close}},[e._v(" "+e._s(e.t("generic.cancel"))+" ")]),o("AsyncButton",{attrs:{"action-label":e.t("asyncButton.rollback.action"),disabled:!e.selectedRevision,"get-option-label":"getOptionLabel","right-align":!0},on:{click:e.save}})],1)])])},i=[],n=(o("13ec"),o("7e5b"),o("bcff"),o("53ca")),a=o("1da1"),s=o("ade3"),c=o("2909"),l=o("a34a"),u=o.n(l),d=(o("96cf"),o("2b77"),o("8be0"),o("0b7a"),o("cf99"),o("e89d"),o("bb4d"),o("38aa"),o("1d8f"),o("67c9")),b=o("5a0c"),f=o.n(b),p=o("d4bf"),v=o("4579"),m=o("a95f"),h=o("bec1"),O=o("8366"),w=o("a788"),k=o("76d1"),y=o("2f62"),R=o("f29a"),g=o("e528"),j=o("2c94");function C(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function D(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?C(Object(o),!0).forEach((function(t){Object(s["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):C(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var _=["metadata.labels.pod-template-hash","spec.selector.matchLabels.pod-template-hash","spec.template.metadata.labels.pod-template-hash","metadata.fields"],N=[].concat(Object(c["a"])(R["a"]),Object(c["a"])(R["b"]),_),E=N.reduce((function(e,t){return e[t]=!0,e}),{}),T={components:{Card:p["a"],AsyncButton:d["b"],LabeledSelect:m["a"],Banner:h["a"],YamlEditor:O["b"]},props:{workload:{type:Object,required:!0}},data:function(){return{errors:[],selectedRevision:null,currentRevision:null,revisions:[],editorMode:O["a"].DIFF_CODE,showDiff:!1}},computed:D(D(D({},Object(y["b"])({t:"i18n/t"})),Object(y["b"])(["currentCluster"])),{},{workloadName:function(){return this.workload.metadata.name},workloadNamespace:function(){return this.workload.metadata.namespace},workloadType:function(){return this.workload.kind.toLowerCase()},revisionsType:function(){return"deployment"===this.workloadType?w["ab"].REPLICA_SET:"apps.controllerrevision"},selectedRevisionId:function(){return this.selectedRevision.id},sanitizedSelectedRevision:function(){return this.sanitizeYaml(this.selectedRevision)},timeFormatStr:function(){var e=Object(j["g"])(this.$store.getters["prefs/get"](g["DATE_FORMAT"])),t=Object(j["g"])(this.$store.getters["prefs/get"](g["TIME_FORMAT"]));return"".concat(e,", ").concat(t)}}),fetch:function(){var e=this;this.$store.dispatch("cluster/findAll",{type:this.revisionsType}).then((function(t){var o=t,r=function(t){var o=t.metadata.relationships,r=o.filter((function(t){var o=t.fromId&&t.fromId==="".concat(e.workloadNamespace,"/").concat(e.workloadName);return o}));return r.length>0},i=o.filter((function(e){return r(e)})),n=i.map((function(t){return e.isCurrentRevision(t)&&(e.currentRevision=t),e.buildRevisionOption(t)})).sort((function(e,t){return t.revisionNumber-e.revisionNumber}));e.revisions=n})).catch((function(t){e.errors=Object(v["c"])(t)}))},methods:{close:function(){this.$emit("close")},save:function(){var e=this;return Object(a["a"])(u.a.mark((function t(){return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.workload.rollBack(e.currentCluster,e.workload,e.selectedRevision);case 3:e.close(),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),e.errors=Object(v["c"])(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))()},isCurrentRevision:function(e){return e.revisionNumber===this.workload.currentRevisionNumber},buildRevisionOption:function(e){var t=e.revisionNumber,o=this.isCurrentRevision(e),r=f()(),i=f()(e.metadata.creationTimestamp),n=i.format(this.timeFormatStr),a=Object(k["a"])(i,r,this.t),s="".concat(n,", ").concat(a.label),c=this.t(a.unitsKey,{count:a.label}),l=this.t("promptRollback.currentLabel"),u=this.t("promptRollback.revisionOption",{revisionNumber:t,revisionAge:s,units:c,currentLabel:o?l:""});return{label:u,value:e,disabled:o,revisionNumber:t}},getOptionLabel:function(e){return e.label},sizeDialog:function(){var e=document.getElementsByClassName("v--modal"),t=this.showDiff?"85%":"600px";1===e.length&&e[0].style.setProperty("--prompt-modal-width",t)},sanitizeYaml:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r={};return e?(Object.keys(e).forEach((function(i){var a=o?"".concat(o,".").concat(i):i;E[a]||(r[i]=e[i],"object"!==Object(n["a"])(e[i])||Array.isArray(e[i])||(r[i]=t.sanitizeYaml(e[i],a)))})),r):e}}},S=T,z=(o("4a7f"),o("0c7c")),A=Object(z["a"])(S,r,i,!1,null,"7c4b6c01",null);t["default"]=A.exports},"4a7f":function(e,t,o){"use strict";o("95bfa")},"95bfa":function(e,t,o){}}]);
//# sourceMappingURL=dialog24.1739eda1.js.map